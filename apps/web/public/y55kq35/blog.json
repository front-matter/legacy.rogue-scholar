{"version":"https://jsonfeed.org/version/1.1","id":"y55kq35","title":"Syntaxus baccata","description":"Thoughts about bibliographic metadata, programming, statistics, taxonomy, and biology.","language":"en","license":"https://creativecommons.org/licenses/by/4.0/legalcode","category":"Engineering and Technology","homePageUrl":"https://larsgw.blogspot.com/","feedUrl":"https://larsgw.blogspot.com/feeds/posts/default","favicon":"https://blogger.googleusercontent.com/img/a/AVvXsEjHdUshBRlHAgurlZYYubJ9yfTRkteSS8hwgor7bpsdHNByrUXglmpVcCS2McVehJLgWZPyr61hB2Nq8iXql2-0qLFfZZHWdMn8wuKGz5UO1vZXWQkRKn_4EelUV6NneQW6fN1wlggv7skzUBri-T7bJZnlzXkKj6FjF8p0wLDR8DXwO7oN8QSwcN9-=s64","generator":"Blogger","items":[{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-5932403088006395537","title":"On the modelling of the content of identification keys","link":"https://larsgw.blogspot.com/feeds/5932403088006395537/comments/default","published":"2023-02-01T15:37:00.002+01:00","description":"Last november I wrote a blog post about how to model the taxonomic coverage of identification keys. I wanted to model this coverage to be able to determine to what extent an identification key applies to a...","isPermalink":false,"tags":["Identification Resources","taxonomy"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T23:25:18.256+02:00","contentHtml":"<p>Last november I wrote a blog post about <a href=\"https://larsgw.blogspot.com/2022/11/on-modelling-and-application-of.html\">how to model the taxonomic coverage of identification keys</a>. I wanted to model this coverage to be able to determine to what extent an identification key applies to a given observation or specimen, for use in my <a href=\"https://larsgw.blogspot.com/2022/08/library-of-identification-resources.html\">Library of Identification Resources</a> project. For the same project I also find it useful to be able to archive identification keys. Many keys can be downloaded as PDFs or saved in the <a href=\"https://archive.org/\">Internet Archive</a>. However, some keys cannot be archived so easily:</p>\n<ul>\n<li>Matrix-type keys (also known as multi-access keys) are usually presented as interactive apps. Sometimes these work from the Wayback Machine, but sometimes they dynamically load additional web resources in which case they do not work. Although this is less common, it also occurs for single-access keys.</li>\n<li>Even non-interactive dichotomous keys can be spread out over multiple web pages. For example, in <a href=\"https://purl.org/identification-resources/catalog/B477\">B477</a> each step has its own page. This can be crawled normally (although it is not yet in this example) but the key still is not in one place.</li>\n<li>Some keys only exist in obscure print (or CD) sources or outdated or otherwise obscure file formats, where it may be useful to have a more standard format to archive or re-publish the data in (taking copyright into account of course).</li>\n</ul>\n<p>In these cases it may be useful to archive the keys in a different format, especially if conserving the source is not feasible. In this blog post I will examine how I think I can best express these keys in more standard formats.</p>\n<p><img src=\"https://inaturalist-open-data.s3.amazonaws.com/photos/81772375/large.jpeg\" alt=\"Metallic blue-green moth with feathered antennae, sitting on a vertical flower stem. In the out-of-focus background there is grass, other stems, and pink flowers.\"><br>\n<a href=\"https://www.inaturalist.org/observations/51466772\"><em>Adscita statices</em>, observed June 28th, 2020</a></p>\n<p>The Library of Identification Resources supports 7 types of resource types: <code>collection</code>, <code>checklist</code>, <code>gallery</code>, <code>reference</code>, <code>key</code>, <code>matrix</code>, and <code>supplement</code>. The first one, <code>collection</code>, is used for pages that link to a variety of different resource that are not all in the same series, and can be modelled with <a href=\"https://schema.org/Collection\"><code>schema:Collection</code></a> or something similar. <code>checklist</code> is also relatively simple, and can be modelled with a list of entities <a href=\"http://rs.tdwg.org/dwc/terms/Taxon\"><code>dwc:Taxon</code></a>, which could be linked to a <a href=\"https://schema.org/ItemList\"><code>schema:ItemList</code></a>.</p>\n<p><code>gallery</code>, <code>reference</code>, <code>key</code>, and <code>matrix</code> are a bit more difficult to model. <code>gallery</code> and <code>reference</code> are both supersets of checklists, that respectively have just an image, or a description and optionally an image, a distribution range, and/or more info for each taxon; <code>key</code> are single-access keys; and <code>matrix</code> are multi-access keys. Regarding <code>gallery</code>: sure, <a href=\"http://Schema.org\">Schema.org</a> has a type for <a href=\"https://schema.org/ImageGallery\"><code>schema:ImageGallery</code></a> but that is specifically for websites, whereas <code>gallery</code> also includes booklets, flyers, and CD-based programs, and the <a href=\"https://schema.org/Collection\"><code>schema:Collection</code></a> type from before does not capture the cohesiveness in my opinion. <code>reference</code>, <code>key</code>, and <code>matrix</code> are even more difficult to capture accurately.</p>\n<p>For these types, I would like to introduce <a href=\"https://www.tdwg.org/standards/sdd/\">Structured Descriptive Data (SDD)</a>¹, a standard from TDWG from 2005 that defines an format to encode descriptions and single-access and multi-access keys in XML files. <code>gallery</code>, <code>reference</code>, <code>key</code>, and <code>matrix</code> can all be expressed in SDD files. However, I think it is missing some features.</p>\n<ol>\n<li>It is not linked data, so it is difficult to relate the content of the key with the metadata.</li>\n<li>SDD has a <code>&lt;Taxon&gt;</code> element but it would be great if SDD files were instead interoperable with the definitions from <a href=\"http://rs.tdwg.org/dwc/terms/Taxon\"><code>dwc:Taxon</code></a>.</li>\n<li>For <code>reference</code> and <code>gallery</code> resources, it should be possible to specify the relation between an image and a taxon.</li>\n<li>For <code>matrix</code> keys, SDD has qualitative/discrete characters and quantitative/continuous characters. Characters relating to temporal, seasonal, and spatial distributions are common in matrix keys, but are difficult to express in SDD. I suggest temporal, seasonal, and spatial characters for both discrete and continuous characters. The former because old keys may for example have divided the continent into regions, but the user should be able to enter coordinates (so a regular discrete character does not suffice); the latter because newer keys may use the future to include more detailed distribution ranges.</li>\n<li>For <code>matrix</code> keys it may be useful to assign probabilities to discrete character states per taxon.</li>\n</ol>\n<p>Lastly, <code>supplement</code> remains. This is a difficult one, even when just listing the taxonomic coverage. The goal when modelling this would be to list the differences between the original source and the “fixed” version in a standard format. If all original sources (i.e., the above types) could be expressed with linked data, the standard format could be the <a href=\"https://www.w3.org/TR/ldpatch/\">Linked Data Patch Format</a>. Of course this would mean that unlike the other types, <code>supplement</code> would <em>not</em> be expressed in linked data, which is a bit unfortunate.</p>\n<hr>\n<p>¹ At the time of writing, TDWG only hosts SDD Primer in the twiki source format on GitHub. I have taken the liberty to parse the twiki source and produce HTML: <a href=\"https://larsgw.github.io/tdwg-wiki-archive/SDD/Primer/SddIntroduction.html\">https://larsgw.github.io/tdwg-wiki-archive/SDD/Primer/SddIntroduction.html</a></p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-8602971925603283253","title":"Citation.js: 2022 in review","link":"https://larsgw.blogspot.com/feeds/8602971925603283253/comments/default","published":"2022-12-31T19:12:00.002+01:00","description":"Following up on the previous two updates this year (Version 0.5 and a 2022 update and Version 0.6: CSL v1.0.2), here are some updates from the second half of 2022, as well as some statistics. Sapygina...","isPermalink":false,"tags":["bibliography","Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:44:33.023+02:00","contentHtml":"<p>Following up on the previous two updates this year (<a href=\"https://larsgw.blogspot.com/2022/05/citationjs-version-05-and-2022-update.html\"><em>Version 0.5 and a 2022 update</em></a> and <a href=\"https://larsgw.blogspot.com/2022/05/citationjs-version-06-csl-v102.html\"><em>Version 0.6: CSL v1.0.2</em></a>), here are some updates from the second half of 2022, as well as some statistics.</p>\n<p><img src=\"https://inaturalist-open-data.s3.amazonaws.com/photos/143165449/original.jpeg\" alt=\"\"><br>\n<a href=\"https://www.inaturalist.org/observations/86860473\"><em>Sapygina decemguttata</em>, a small wasp, observed July 8th, 2021</a></p>\n<h3 id=\"changes\">Changes</h3>\n<ul>\n<li>The mappings of the Wikidata plugin were updated, especially to accomodate for software.</li>\n<li>The <code>default-locale</code> setting of some CSL styles is now respected.</li>\n</ul>\n<h3 id=\"new-plugins\">New plugins</h3>\n<ul>\n<li><a href=\"https://github.com/citation-js/plugin-enw\"><code>plugin-enw</code></a> for <a href=\"https://en.wikipedia.org/wiki/EndNote#Import_format\"><code>.enw</code> files</a> (similar, but different from <a href=\"https://en.wikipedia.org/wiki/Refer_(software)#Example\">Refer files</a>).</li>\n<li><a href=\"https://github.com/citation-js/plugin-wikipedia-templates\"><code>plugin-wikipedia-templates</code></a> for outputting <a href=\"https://en.wikipedia.org/wiki/Template:Citation_Style_documentation/cs1\">Citation Style 1 templates</a> to use on pages of the <a href=\"https://en.wikipedia.org\">English Wikipedia</a>.</li>\n</ul>\n<h3 id=\"new-users\">New users</h3>\n<ul>\n<li>WikiPathways is in the process of moving to a <a href=\"http://new.wikipathways.org/\">new site</a> which uses Citation.js to generate citations.</li>\n<li>Page, R. D. (2022). Wikidata and the bibliography of life. <em>PeerJ</em>, <em>10</em>, e13712. <a href=\"https://doi.org/10.7717/peerj.13712\">10.7717/peerj.13712</a></li>\n<li>Boer, D. (2021). A Novel Data Platform for Low-Temperature Plasma Physics. [Master’s thesis] Radboud University, Nijmegen, The Netherlands. <a href=\"https://research.tue.nl/en/studentTheses/a-novel-data-platform-for-low-temperature-plasma-physics\">URL</a></li>\n</ul>\n<h3 id=\"statistics\">Statistics</h3>\n<p><code>@citation-js/core</code> was downloaded approximately 240,000 times in 2022, against 205,000 times in 2021. The legacy package <code>citation-js</code> was downloaded approximately 160,000 times (compared to 190,000 times in 2021). This is good, as it indicates people are starting to use the new system more often. Note that most downloads of <code>citation-js</code> also lead to a download of <code>@citation-js/core</code> so most people still use the legacy package. The shift to stop using <code>citation-js</code> seemed to have started in October 2021, which coincides with the time time I forgot to update that package for 2 months after releasing v0.5.2 of <code>@citation-js/core</code>.</p>\n<p>Since February 2022 a relative decrease in downloads of <code>@citation-js/plugin-wikidata</code> compared to <code>core</code> is also visible. In December the Wikidata plugin was downloaded more than 50% fewer times, in fact. This is also good and the exact point of the modularisation introduced back in 2018: to let users choose which formats to include. The DOI plugin was similarly less popular, while the BibTeX and CSL plugins were — as expected — almost always included. Surprisingly, BibJSON, a very niche format, only had a 25% reduction (maybe due to confusion with BibTeX and the internal BibTeX JSON format), while RIS, after BibTeX the most common format, had a 50% reduction as well.</p>\n<h3 id=\"new-years-eve-tradition\">New Year’s Eve tradition</h3>\n<p>After the releases on New Year’s Eve of 2016, 2017, and 2021, this New Year’s Eve also brings the new <a href=\"https://github.com/citation-js/citation-js/blob/main/CHANGELOG.md#065-2022-12-31\"><code>v0.6.5</code> release</a> which changes the priority of some RIS fields in very specific situations, most notably the date field of conference papers (now using <code>DA</code> instead of <code>C2</code>).</p>\n<p>Happy New Year!</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-1714815721131835044","title":"Explore identification keys on the world map","link":"https://larsgw.blogspot.com/feeds/1714815721131835044/comments/default","published":"2022-12-23T16:05:00.001+01:00","description":"The website of the Library of Identification Resources has a new feature: a map view. The resources in the catalog are associated with a geographic scope to approximate which species in a taxonomic group can...","isPermalink":false,"tags":["Identification Resources"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:45:07.809+02:00","contentHtml":"<p>The website of the <a href=\"https://identification-resources.github.io/\">Library of Identification Resources</a> has a new feature: a <a href=\"https://identification-resources.github.io/catalog/visualizations/map/\">map view</a>. The resources in the catalog are associated with a geographic scope <a href=\"https://larsgw.blogspot.com/2022/11/on-modelling-and-application-of.html\">to approximate which species in a taxonomic group can be identified</a>. These geographic scopes are usually countries or continents but can also be subdivisions within countries, multinational ecological regions like mountain ranges, and <a href=\"https://en.wikipedia.org/wiki/Biogeographic_realm\">biogeographical realms</a>.</p>\n<p>The scopes are <em>also</em> linked to Wikidata identifiers, and the Wikidata identifiers are linked to iNaturalist identifiers. This makes it possible to get <a href=\"https://en.wikipedia.org/wiki/GeoJSON\">GeoJSON</a> of these places from the <a href=\"https://api.inaturalist.org/v1/docs/#!/Places/get_places_id\">iNaturalist API</a>. Then the places can be displayed with the <a href=\"https://leafletjs.com/\">Leaflet</a> library, and shaded according to the number of resources associated with it.</p>\n<p><img src=\"https://identification-resources.github.io/assets/img/screenshot_map.png\" alt=\"Map of the world with certain continents, countries, and lower divisions with black outlines and colored in various shades of red depending on the number of resources. Europe, especially western Europe is the darkest red.\"><br>\n<em>World map with countries, continents and other regions shaded according to the number of associated resources.</em></p>\n<p>There are a number of places that are not displayed:</p>\n<ol>\n<li>The biogeographical realms are not all in iNaturalist (e.g. Indomalayan realm).</li>\n<li>Some places like have ambiguous definitions (e.g. the Middle East) making it difficult to decide whether to link their Wikidata &amp; iNaturalist entities if different definitions are used.</li>\n<li>Other places are historical and are difficult to express in modern borders (e.g. Japanese Empire in ca. 1930).</li>\n<li>A number of resources have scopes that have never been expressed in political borders (e.g. “the coast of Italy”).</li>\n</ol>\n<p>All in all 347 of the current 1286 resources are not displayed, though it should be noted that 72 of those have no scope (e.g. keys for all globally known species).</p>\n<p>Either way, the map clearly shows the geographical bias: Western Europe, especially the Netherlands, is overrepresented. This is because I have been mostly adding Dutch resources and various series from the UK (<a href=\"https://identification-resources.github.io/catalog/series/?issn=0962-5852\">RES Handbooks</a>), France (<a href=\"https://identification-resources.github.io/catalog/series/?issn=0374-762X\">Faune de France</a>), Denmark (<a href=\"https://identification-resources.github.io/catalog/series/?issn=0070-2757\">Danmarks Fauna</a>), Sweden (online keys and Nationalnyckeln), and Norway (<a href=\"https://identification-resources.github.io/catalog/series/?issn=1503-2108\">Norske Insekttabeller</a>).</p>\n<p>The map is available from the home page and at <a href=\"https://identification-resources.github.io/catalog/visualizations/map\">https://identification-resources.github.io/catalog/visualizations/map</a>.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-1598470798255529160","title":"On the modelling and application of the taxonomic coverage of identification keys","link":"https://larsgw.blogspot.com/feeds/1598470798255529160/comments/default","published":"2022-11-09T14:00:00.002+01:00","description":"The main feature of the Library of Identification Resources is the description of the identification key (or matrix, reference, etc.). This description should on its basis specify when the key can or should...","isPermalink":false,"tags":["Identification Resources","taxonomy"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:44:53.725+02:00","contentHtml":"<p>The main feature of the <a href=\"https://larsgw.blogspot.com/2022/08/library-of-identification-resources.html\">Library of Identification Resources</a> is the description of the identification key (or matrix, reference, etc.). This description should on its basis specify when the key can or should be used. I have initially split this description into the taxonomic coverage and the ‘scope’. The latter includes life stage and sex but also some restrictions on the taxonomic coverage that are more difficult to characterize, like “species that cause galls on plants in the <em>Rosa</em> genus” or “species that live in aquatic environments”.</p>\n<p><img src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEihHS8ko0oUC3g975SnYUJmYWMF22wugjdoGO0JjNzh9Jw_Av8H5KClHlpSY1qTj6bKlqUiEKQT7XFQkTZ-zYAVDtzyh_2tyUwvo-xmCyKPAhshogm-Tn5qEMiKPPEc-3wKf6hsQyzhIsYprWFun3QiTqxP3cvbYr7iNV9Dv2ODbrG-K_JX4RI9GqFH/s1600/original%20%281%29.jpeg\" alt=\"Hairy, black moth with long antennae with a clubbed end, and narrow, blue-speckled wings with bright red spots, with a bright yellowish green background consisting of out-of-focus grass\"><br>\n<em>Zygaena filipendulae</em> (Linnaeus, 1758)</p>\n<h3 id=\"simple-solution\">Simple solution</h3>\n<p>For the taxonomic coverage <em>sensu stricto</em>, I started with the parent taxon, e.g. the family or genus. However, many keys do not treat all the species in a family, and are instead limited by a geographic scope. This geographic scope should clearly also be included. Then there are more casual keys that can be very useful but may not be complete even at the time of publication, either excluding some rare species or only including some common species. This can be detailed (to some extent) with an incomplete/complete switch. Finally, although many keys are for species, there are some keys primarily for identifying genera, families, or other ranks. Below are some example works where these aspects do or do not apply.</p>\n\n<table>\n<thead>\n<tr>\n<th>Title</th>\n<th>Parent taxon</th>\n<th>Geographic scope</th>\n<th>Incomplete</th>\n<th>Target rank</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://purl.org/identification-resources/catalog/B460\">B460</a>: A revision of the world Embolemidae (Hymenoptera Chrysidoidea)</td>\n<td>Embolemidae</td>\n<td>—</td>\n<td>—</td>\n<td>—</td>\n</tr>\n<tr>\n<td><a href=\"https://purl.org/identification-resources/catalog/B1\">B1</a>: Identification Key to the European Species of the Bee Genus <em>Nomada</em> Scopoli, 1770 (Hymenoptera: Apidae), Including 23 New Species</td>\n<td><em>Nomada</em> Scopoli, 1770</td>\n<td>Europe</td>\n<td>—</td>\n<td>—</td>\n</tr>\n<tr>\n<td><a href=\"https://purl.org/identification-resources/catalog/B81\">B81</a>: Key to some European species of Xylomyidae</td>\n<td>Xylomyidae</td>\n<td>Europe</td>\n<td>Yes</td>\n<td>—</td>\n</tr>\n<tr>\n<td><a href=\"https://purl.org/identification-resources/catalog/B63\">B63</a>: MOSCHweb - Interactive key to the genera of the Palaearctic Tachinidae (Insecta: Diptera)</td>\n<td>Tachinidae</td>\n<td>Palaearctic realm</td>\n<td>—</td>\n<td>genus</td>\n</tr>\n</tbody>\n</table><h3 id=\"if-only-it-were-that-simple\">If only it were that simple</h3>\n<p>It became clear quite quickly that this is not enough. For one, parent taxon, geographic scope, and target rank should be able to contain multiple values. Additionally, as we saw before, some taxonomic coverages like “gallers on <em>Rosa</em> sp.” cannot be captured with these parameters unless the “Parent taxon” list gets very long and detailed.</p>\n<p>Another, more common problem is that even the combination of a parent taxon and a geographic scope is hardly specific enough to be able to say whether an identification key is reliable and complete for a situation. Species are discovered, migrate, emigrate, and become extinct. Taxa are moved to different genera, families, and orders. In <a href=\"https://purl.org/identification-resources/catalog/B659\">B659</a>: <em>Orthoptêres et Dermaptêres</em> (Faune de France 3) from 1922, the order Orthoptera also contains Dictyoptera, currently a superorder consisting of cockroaches, stick insects, praying mantises, and more. This is a big problem too. Key questions that should be answerable are “How well does a British key apply to a Dutch observation?” and “How well does a British key from 1950 apply to a British observation from 2020?”</p>\n<p>To account for the changes within higher-level taxa you might want to make a list of species that are included in the keys. For B81 for example, that could look like this:</p>\n<p><img src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdVOYZoC91yVPtq6LSa4-OcBmm5SK_D6ITN64m62Dej740HA64a4Krp9k9-QI4E21eluLZX6cnCNwvkBRI-8KGA-MERyXW20WwwyR8OM28lygdf1XjbrQpTPuSILQRp0LJMuhCbVaxnOtOwRnqei1ZMRwBvwgXjpo-Y6GqS8qoqH0q-N7ItghI2TDV/s1600/identification-resources.github.io_catalog_resource__id=B81_1.png\" alt=\"Screenshot of a webpage titled &quot;Identification resource B81:1&quot;, linked below. The relevant part of the webpage is a tree of taxa, consisting of one family containing two genera, containing 2 and 1 species respectively.\"><br>\n<em><a href=\"https://purl.org/identification-resources/resource/B81:1\">https://purl.org/identification-resources/resource/B81:1</a></em></p>\n<p>This gives a very clear image of the taxonomic coverage of the key: it includes three species, <em>Salva marginata</em>, <em>S. varia</em> and <em>Xylomya maculata</em>. The inclusion of the species in this key has a permalink, and the taxon is linked to a GBIF identifier. The list of species can then be matched (especially with the identifiers) to current checklists for the region that the observation was made in. More on that later.</p>\n<p>This solution can easily be used for more complex taxonomic coverages, like the aforementioned key for species that cause galls on <em>Rosa</em> species. The ‘species’ list can also be a taxon list and have e.g. genera as the lowest rank. Another advantage is that there is no longer a need to explicitly specify the geographic scope, whether or not the key was known to be incomplete at the time of writing, and what the target taxon rank of the key is. In addition, this specific implementation also allows for multiple keys per work, which has various uses.</p>\n<h3 id=\"two-purposes\">Two purposes</h3>\n<p>One problem that still comes up is that these taxon lists have two purposes:</p>\n<ol>\n<li>They describe which taxa can be distinguished with the key.</li>\n<li>They describe which taxa are considered when making the key.</li>\n</ol>\n<p>These two are at odds. In a key to genera it would be simple to make a list of these genera, fulfilling (1) but not (2): if a species in of those genera gets moved to a different one, or if an additional species in one of the existing genera appears, the key ‘breaks’. The latter could be fixed by just listing all species but at that point you might as well fix both problems with (2) by grouping the species by genus. To simultaneously fulfill purpose (1) <em>and</em> (2) it is necessary to divide the taxonomic tree into units that can be distinguished by the key.</p>\n<p>Even when fulfilling purpose (1) it is still possible to partially accomplish (2) in keys for e.g. families that key out to species. If, when making the species list, higher ranks such as genera are included, the key to genera can be validated according to (2) without having to go into more detail than the key. Therefore it is important to capture the entire taxonomic tree as presented in the work.</p>\n<p>Another thing that might be useful to record is the synonyms. Many of the more academic works publish along with the key a series of descriptions including synonyms. If the status of that synonymic taxon is now different from the status in the key, this may be of importance to the results of the identification. It comes down to the same split of purposes: (1) no distinction is made in the key between the two taxa but (2) both taxa are, in theory, considered. Either way it is important to list both in some way.</p>\n<h3 id=\"if-only-it-were-that-simple-1\">If only it were <em>that</em> simple</h3>\n<p>At this point it became clear which taxa are necessary to include in such a list. But how to describe the taxa in those lists? This is an (enormous) rabbit hole in and of itself, and if I had more experience I could make a <a href=\"https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/\">Falsehoods Programmers Believe About Names</a>-style post about it. It starts with the normal parts: every taxon has a name, an author, a year, and a rank. That rank can be kingdom, phylum, class, order, family, genus, or species. But there is a seemingly endless list of increasingly obscure ranks, sometimes only in use by one or a few authors (<a href=\"https://mastodon.social/@rmounce/109308470177679412\">what is a “stirps”??</a>); taxa can have multiple authors and different ways of presenting this (<code>et</code>/<code>and</code>/<code>&amp;</code> and <code>et al.</code> or listing everyone); the names themselves can be spelled in different ways and include or omit initials; the year can be very unclear, especially for taxa published in older works published over multiple years; and the scientific names themselves can have different spellings, capitalizations, and hyphenations as well.</p>\n<p>As with personal names, the ‘trick’ is to trust the source to some extent, and avoid focussing on the specifics of the scientific name. After all, there is no reason to make the computer understand the scientific names. The goal is to allow for matching (and there are ways to do that without trying to standardize everything) and, secondarily, to present the names in such a way that humans can understand them (and the original key already did that).</p>\n<h3 id=\"measuring-applicability-more-problems\">Measuring applicability (more problems)</h3>\n<p>Now, with a complete and structured taxonomic tree, the question becomes how to check whether it applies to a certain observation. The idea is to compare the taxon list to a list of all the species that a certain observation <em>could</em> be. But where does such a list come from? The simple solution would be a checklist: a professional, thorough list of all the species that are known to occur in a certain area.</p>\n<p>If such a checklist is not (easily) available (I am not aware of a global database of checklists, let alone in a standardised format), it might be tempting to create one from a map of observations from e.g. <a href=\"https://www.gbif.org/\">GBIF</a>. The advantage of this is that you have, to some extent, global coverage and a standardised format. However, this has some caveats. The correctness of the resulting checklist is entirely dependent on the quality and quantity of the observations in the region. To get a higher sensitivity it may be useful to instead make a checklist of a larger, encompassing region, but this lowers the specificity. A species occurring in Belgium might only have recorded observations in the Netherlands on GBIF. The same goes for the time scale. There might be museum specimens of species that are now extinct in the region, but there might also be rare species that are only seen every 50 years or so.</p>\n<p>A good addition (or a risky alternative) to a checklist would be a measure of the (relative) abundance of species in the region, and weighing the taxon lists of the keys according to that. This prioritises keys that include more common species over keys that include more rare species. Of course, the key of common species can be wrong about an observation of a rare species. Another problem is how to determine the (relative) abundance. Again it is tempting to derive this from GBIF observations, but a species with a lot of observations is not necessarily more common. It might be the focus of an observation campaign, or national attention of a different kind, it might sit still more often, it might be easier to recognize, or it might even be easier to identify to a species level.</p>\n<p>An additional possibility of measuring applicability is bringing the scope restrictions mentioned at the start into this. Apart from belonging to a certain taxon, the observed organism also has a biological sex, a life stage, and more characteristics that may restrict which keys can be used. To compare these characteristics between keys and organisms they need to be described with a common, consistent vocabulary. <a href=\"https://www.inaturalist.org/\">iNaturalist</a> has such a vocabulary (<a href=\"https://www.inaturalist.org/pages/annotationvalues\">the “Annotations”</a>), but there might be more suitable ones out there somewhere.</p>\n<p>(For this it might also be useful to map keys that distinguish castes of ants, males/females of solitary bees, or life stages of shield bugs. How do you model <em>that</em>? Not in the same way as described above, that is for sure.)</p>\n<h3 id=\"using-the-data\">Using the data</h3>\n<p>As I teased in the previous blog post about the Library of Identification Resources, I have started to collect this data, and attempted to recruit some others to contribute as well. All works which have their keys (and matrices, checklists, descriptions) mapped out can be found by searching for “TRUE” in the “Tax. data extr.” field. To get from the work page to a taxa list, look for the row titled “Resources” in the first table on the page. If available it lists the individual resources in the work for which the taxonomic data is extracted.</p>\n<p>The pages for the taxonomic data of the individual resources contains some basic information about the work (as well as a link), as well as the page numbers of the resource within the work if available. There is also some info on the resource, derived from the same info in the work unless different for that resource. Then there is a list of taxa, displayed as a tree. Each taxon has a rank, an anchor, and if available a link to the corresponding taxon in GBIF.</p>\n<p>The data is also used in the <a href=\"https://identification-resources.github.io/proof-of-concept/\">proof-of-concept app</a> that I introduced in the previous blog post. Searching for a taxon and coordinates will now query GBIF for observations in that taxon in the country encompassing the coordinates, and match this with the GBIF identifiers in the taxon lists. It displays the relative amount of taxa in the ‘checklist’ that are also in the key as a percentage and a small pie chart. It does not yet deal with synonyms.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-8038525172646010508","title":"Library of Identification Resources","link":"https://larsgw.blogspot.com/feeds/8038525172646010508/comments/default","published":"2022-08-06T18:34:00.001+02:00","description":"Since around this time last year, I have been working on creating a library of identification resources. Here, “identification resources” are identification keys, multi-access (matrix) keys, other works that...","isPermalink":false,"tags":["Identification Resources","taxonomy"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:44:46.503+02:00","contentHtml":"<p>Since around this time last year, I have been working on creating a library of identification resources. Here, “identification resources” are identification keys, multi-access (matrix) keys, other works that can aid in the identification of species. The project is managed on GitHub: <a href=\"https://github.com/identification-resources\">https://github.com/identification-resources</a>.</p>\n<p><img src=\"https://identification-resources.github.io/assets/img/logo_512.png\" alt=\"Digital drawing of a black moth with red spots and light speckles on the forewings and red hindwings. Below the moth is a grey bar signifying a label, and the whole picture has a light beige background.\"><br>\nThe logo: <em>Zygaena filipendulae</em> (Linnaeus, 1758)</p>\n<h2 id=\"about-the-project\">About the project</h2>\n<p>Right now the project mainly consists of a catalog, a list of works (or rather “manifestations” in the <a href=\"https://en.wikipedia.org/wiki/Functional_Requirements_for_Bibliographic_Records\">FRBR model</a>) that contain identification resources. The catalog contains bibliographic information, but also a summary of the identification resource(s) that they contain.</p>\n<p>This summary consists of the starting taxon or taxa (e.g. Chrysididae), a region that the resource applies to (e.g. Europe), an optional scope (e.g. adults, males and females), the taxonomic rank(s) that the resource distinguishes (usually species), and whether the key was supposed to be complete for the region-scope combination at the time of publication.</p>\n<p>This data is similar to that provided by <a href=\"https://www.bioinfo.org.uk/index.htm\">BioInfo UK</a> (<a href=\"https://www.bioinfo.org.uk/html/b61133.htm\">example</a>). They actually go in more detail, with more nuance in completeness, the equipment required for using the key (e.g. stereo microscope), whether and what specimen preparation is required, and expert reviews. The Library of Identification Resources does not include this information, but has a broader geographical scope<a href=\"#20220806f1\" id=\"20220806r1\">¹</a> and can be searched in a more structural way.</p>\n<p>The places (for the geographical scope of keys) and the authors and publishers linked to works as well as the works themselves are linked to <a href=\"https://wikidata.org\">Wikidata</a> entities wherever possible. Journals and book series are linked to <a href=\"https://portal.issn.org/\">ISSN</a>s.</p>\n<h2 id=\"using-the-data\">Using the data</h2>\n<p>On top of this catalog, I built a website: <a href=\"https://identification-resources.github.io/\">https://identification-resources.github.io/</a>. This provides a user interface, allowing for structured searches through the catalog, linking multiple versions (FRBR “manifestation”) of the same work (FRBR “work”), a few graphs exploring the distribution of languages, licenses, etc., and some additional functionality like exporting citations.</p>\n<p>To improve searching, I am also working on an app that lists the most relevant resources for a given situation. In the <a href=\"https://identification-resources.github.io/proof-of-concept/\">proof-of-concept</a> (<a href=\"https://github.com/identification-resources/proof-of-concept\">GitHub</a>) users can enter a parent taxon and a coordinate location and get (possibly) applicable resources for that situation. This uses the GBIF API for taxon searches, and the iNaturalist API for looking up places around coordinates.</p>\n<p>Results are sorted according to a few heuristics, including:</p>\n<ul>\n<li>The availability of full text.</li>\n<li>How close the key taxon is: a key for Vespidae is likely better than one for Insecta, when identifiying Vespa.</li>\n<li>How recent the resource is.</li>\n<li>Whether the level of detail indicates that the key can actually improve on the parent taxon.</li>\n<li>Whether the resource was considered complete during publication.</li>\n<li>Whether the resource is a (matrix) key, just a reference or a photo gallery, or even a just collection of other resources (which are not guaranteed to contain anything relevant, and if they did, they would likely show up in the results already).</li>\n</ul>\n<p>The data is currently biased towards the Netherlands and the rest of western Europe, as well as towards insects and mainly Hymenoptera. This is because I have mainly worked on adding resources that I was using, or resources referenced therein.</p>\n<p><img src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj_VWlHQeNFNgNWF9TR4baf2lK5v_6s4kcAxb9RDhH86b4CbYi1M5fAaqioPQTmZ2yxknTpVzvXYi89YHSwzrmRG-lMLFK6piLrTawfs67O1q2l_4OWamscFFldKyXgvvjd_XjUm0LnxgTQ33LRscJbGO1jhE3KVJ-UFJD05hsi8zQVJ-HMF8IBCqJQ/s1600/Screenshot_20220803_143727.png\" alt=\"Screenshot of a website. The header has a logo of a moth, the text &quot;Library of Identification Resources&quot; and three links, &quot;Catalog&quot;, &quot;Statistics&quot;, and &quot;GitHub&quot;. In the main part: in the top left is a paragraph of text; in the top right two input fields labeled &quot;Taxon&quot; and &quot;Location&quot; and a button labeled &quot;Search&quot;; on the left is a table listing items and on the right is an embedded PDF viewer\"><br>\n<a href=\"https://identification-resources.github.io/proof-of-concept/?taxon=1458&amp;location=45%2C5\"><em>The proof-of-concept app in action.</em></a></p>\n<h2 id=\"future-plans\">Future plans</h2>\n<h3 id=\"improving-the-interface\">Improving the interface</h3>\n<p>I want to improve the interface of the proof-of-concept app and I have a number of ideas for this:</p>\n<ul>\n<li>Allow users to “upload” photos. These would not be uploaded to a server but rather just displayed locally, but could serve a couple of purposes:\n<ul>\n<li>Automatic extraction of coordinates from EXIF data</li>\n<li>Automatic determination of a parent taxon using computer vision [needed: a computer vision model :)]</li>\n<li>Viewing the key side-by-side with the photos.</li>\n</ul>\n</li>\n<li>Same, but by entering a GBIF/iNaturalist observation ID.</li>\n</ul>\n<h3 id=\"improving-the-data-model\">Improving the data model</h3>\n<p>One of the main improvements that I want to make is modeling of individual keys/resources within works for two reasons:</p>\n<ol>\n<li>Works can contain multiple resources with completely different properties. If a work contains a key of Family A to Genus B and C, a key to the species of Genus B, and a key to the species of Genus C, those can be modeled as a single key to the species of Family A (assuming B and C are the only relevant genera). But this is not always the case. In addition, a work can contain resources of different types, like a key and a checklist (<a href=\"https://purl.org/identification-resources/catalog/B159\">B159</a>).</li>\n<li>Listing the taxa in the resource. I am aware of a few problems with this, but a list of species in a key can be matched to a modern checklist. This gives a better idea about how well a British key could apply to a Dutch observation (or an older British key to a more recent British observation, with all the species migration going on).</li>\n</ol>\n<p><img src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgaNYXkNcOYtWrglSfSSttp7H9J35xwX-g8QbthzQbQZfbe7LMW0I3bHFt6Dy3W2p10Fe99LflIeqsZOISDCdV-esSvKZoY-gnIWxiIcWPVeaR1lSxC6pEFZPsQ2yIFk3s8d6NJWRnPwyp13YZ_ZqS7dwUjELBOFxFzqegkSY-xynXe9ae5UDfF8WD6/s1600/Screenshot_20220806_154826.png\" alt=\"A screenshot of a collapsible taxonomic tree, where each taxon has a taxon name, a rank in grey text, a link icon and usually a GBIF icon\"><br>\n<em>Example of what this would look like.</em></p>\n<h3 id=\"contributing-data\">Contributing data</h3>\n<p>You are welcome to <a href=\"https://github.com/identification-resources/catalog/blob/main/CONTRIBUTING.md#adding-resources\">contribute data to the catalog</a>. I plan to make this easier in the future, as currently the master copy of the data is still in the non-version-controlled spreadsheet that I started the work in.</p>\n<hr>\n<p><a href=\"#20220806r1\" id=\"20220806f1\">¹</a> Note that the current data has a geographical bias, but this is not the same as a strict scope in my opinion.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-5191413998020114404","title":"Citation.js Version 0.6: CSL v1.0.2","link":"https://larsgw.blogspot.com/feeds/5191413998020114404/comments/default","published":"2022-05-31T12:35:00.001+02:00","description":"Since the citation-js npm package was first published, version 0.6 is the first major version of Citation.js that did not start out as a pre-release. Version 0.3 itself spent almost 6 months in pre-release,...","isPermalink":false,"tags":["bibliography","Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:45:24.506+02:00","contentHtml":"<p>Since the <code>citation-js</code> npm package was first published, version 0.6 is the first major version of Citation.js that did not start out as a pre-release. Version 0.3 itself spent almost 6 months in pre-release, but only received updates for less than half a month. Version 0.4 spent more than a year in pre-release and received updates for about 4 months. Version 0.5 takes the cake with one and a half years in pre-release, receiving updates for a year, also making it the best-maintained version.</p>\n<p><img src=\"https://inaturalist-open-data.s3.amazonaws.com/photos/185099495/original.jpeg\" alt=\"Yellow flowers with lots of little &quot;rays&quot; on greenish brown stems\"></p>\n<p><a href=\"https://www.inaturalist.org/observations/109786995\"><em>Tussilago farfara</em>, March 27th, 2022</a></p>\n<p>Version 0.6 is a major version bump because it introduces a number of breaking changes, including raising the minimal Node.js version to 14. Since April 2022, Node.js 12 is End-Of-Life, which led to a lot of dependencies dropping support. Now, Citation.js does so too. Other changes include the following:</p>\n<h3 id=\"update-data-format-to-csl-v1.0.2\">Update data format to CSL v1.0.2</h3>\n<p>The internal data format is now updated from CSL v1.0.1 to v1.0.2. This introduces the <code>software</code> type and the generic <code>document</code> type, as well as some other types, and some new fields. The <code>event</code> field is also renamed to <code>event-title</code>. That, and <code>software</code> replacing <code>book</code>, makes it so that CSL v1.0.2 is not compatible with CSL v1.0.1 styles, making it a breaking change.</p>\n<ul>\n<li>CSL data is now automatically upgraded to v1.0.2 on input.</li>\n<li><code>Cite#data</code> (<code>(new Cite()).data</code>) now contains CSL v1.0.2 data.</li>\n<li>Output formatters of plugins now receive CSL v1.0.2 data as input.</li>\n<li><code>util</code> (<code>import { util } from '@citation-js/core'</code>) now has two functions, <code>downgradeCsl</code> and <code>upgradeCsl</code>, to convert data between the two versions.</li>\n<li>The <code>data</code> formatter (<code>.format('data')</code>) now takes a <code>version</code> option. When set to <code>'1.0.1'</code>, this downgrades the CSL data before outputting.</li>\n<li><code>@citation-js/plugin-csl</code> already automatically downgrades CSL to v1.0.1 for compatibility with the style files.</li>\n<li>Custom fields are now generally put in the <code>custom</code> object, instead of prefixing an underscore to the field name.</li>\n</ul>\n<p>The mappings are also updated. Especially the RIS and BibLaTeX mappings were made more complete by the increased capabilities of the CSL data schema. Non-core plugins are also being updated, mainly affecting <code>@citation-js/plugin-software-formats</code> and <code>@citation-js/plugin-zotero-translation-server</code>.</p>\n<h3 id=\"test-coverage\">Test coverage</h3>\n<p>While updating the plugin mappings, the test suites of the plugins were also expanded. This led to the identification of a number of bugs, that were also fixed in this release:</p>\n<ul>\n<li>BibLaTeX\n<ul>\n<li>handling of CSL entries without a <code>type</code></li>\n<li>handling of <code>bookpagination</code></li>\n<li>handling of <code>masterthesis</code></li>\n</ul>\n</li>\n<li>RIS\n<ul>\n<li>RegExp pattern for ISSNs</li>\n<li>Name parsing of single-component names</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"closing-issues\">Closing issues</h3>\n<p>A number of issues were also fixed in this release:</p>\n<ul>\n<li>Adding full support for the Bib(La)TeX <code>crossref</code> field</li>\n<li>Mapping BibLaTeX <code>eid</code> to <code>number</code> instead of <code>page</code></li>\n<li>Adding a mapping for the custom BibLaTeX <code>s2id</code> field</li>\n<li>In Wikidata, getting issue/volume/page/publication date info from qualifiers as well as top-level properties.</li>\n</ul>\n<h3 id=\"csl-styles\">CSL styles</h3>\n<p>The bundled styles (<code>apa</code>, <code>vancouver</code>, and <code>harvard1</code>) were updated. Note that <code>harvard1</code> is now an alias for <code>harvard-cite-them-right</code>. Quoting the documentation:</p>\n<blockquote>\n<p>The original “harvard1.csl” independent CSL style was not based on any style guide, but it nevertheless remained popular because it was included by default in Mendeley Desktop. We have now taken one step to remove this style from the central CSL repository by turning it into a dependent style that uses the Harvard author-date format specified by the popular “Cite Them Right” guide. This dependent style will likely be removed from the CSL repository entirely at some point in the future.<br>\n<em><a href=\"http://www.zotero.org/styles/harvard1\">http://www.zotero.org/styles/harvard1</a></em>, <a href=\"http://creativecommons.org/licenses/by-sa/3.0/\">CC-BY-SA-3.0</a></p>\n</blockquote>\n<h3 id=\"looking-forward\">Looking forward</h3>\n<p>Some breaking changes are still pending, mainly changes to the plugin API and the removal of some left-over APIs. However, I also want to work on a more comprehensive format for machine-readable mappings, a format for mappings for linked data, and of course implementing more mappings in general!</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-3109069353644000063","title":"A story about a university login with a broken security configuration, and a mildly uncooperative help desk","link":"https://larsgw.blogspot.com/feeds/3109069353644000063/comments/default","published":"2022-05-30T11:25:00.001+02:00","description":"Last semester I followed some courses at a different university, and went through the process of collecting login credentials and multi-factor authentication tokens and familiarizing myself with a network of...","isPermalink":false,"tags":["programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:17.859+02:00","contentHtml":"<p>Last semester I followed some courses at a different university, and went through the process of collecting login credentials and multi-factor authentication tokens and familiarizing myself with a network of university systems all over again. Most (but not all) of those systems use the main single sign-on login process of the university, at <code>https://login.universityfoo.nl</code>.</p>\n\n<table>\n<thead>\n<tr>\n<th>Note</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>The university has two main domains, let’s call them <code>universityfoo.nl</code> and <code>universitybar.nl</code>.</td>\n</tr>\n</tbody>\n</table><p>One of those systems is <a href=\"https://en.wikipedia.org/wiki/D2L#Brightspace\">Brightspace</a>, used by course coordinators to communicate course information, syllabi, and additional documents to students. Very important for someone new to the university, especially someone who did not go through the normal process of introduction weeks and tutorials. But when I logged in at <code>https://login.universityfoo.nl</code>, I was met with a blank screen. Other systems worked fine, including those to set up my email, but Brightspace did not.</p>\n<p>Naturally I opened the trusted Chrome DevTools and saw the following error:</p>\n<blockquote>\n<p><code>Refused to navigate to 'https://brightspace.universitybar.nl/d2l/lp/auth/login/samlLogin.d2l' because it violates the following Content Security Policy directive: \"navigate-to 'self' https://*.universityfoo.nl:443 https://*.services.universitybar.nl:443\".</code></p>\n</blockquote>\n<p>That was already pretty clear: one of the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP\">Content Security Policy</a> directives was simply blocking any navigation to any domains other than a short list of exceptions, which did not include the domain that Brightspace was on. But that seems like a major problem, one that would have been caught already unless I had some incredibly (un)lucky timing.</p>\n<p><img src=\"https://lh3.googleusercontent.com/OrAeizsPxh8K90JMUd0HscyZTHVnBjiXzYMp8-hEB6WPslUItSmWV6nLR6-LzMBtxn0QmirOj6s50dHsyiDMlN1UcuH8gNqghKAfAhmXz9YbTjLQyRAhzqBbek8ZkUjKEgSH-CxzJvgqsw3mpuQlsQhE0f6CRx5bD5AtWG9bN9SKczjwa55X7Q27ZyPDD5yVUD20FISWyHfBYQAJ-yyjLvPRyHP5jUBc-H9YBbpSGcKpwbtY_TyGZi9lfUM7Yh5UuzePLQSzZi9jXirAGDZyiaw6CcjHkWS_AckM3El_JDbXzhagUBPCkTIT5xEu54YBkKnI3kCP-fRJ0nfsT5xAkLLYuz-09g3o5BPaLFrfX98uJxORvezjZfCO8cVpsSI6BBQl41Zyjgckx54e5Aw0XDS0zIhkMZojuLrfneFaEfMU-WJab5OjPRMT0Pmk60kglP1V_6J5fq7zk5ed_NZYGE6Os98jOnSdyWrtfvzFzknDdfqDa9BGlauAE9IvJZBK9o9nxwHQ8TOPCP4vwLo6F0pG9NVJdoKU-TUyp7irNyvIRbGBfPmryg3gYBdW9-2ZZj0ffol3YkTBImJOcnrvH-WNvLY9hah_4bTxK7WRXTqp3pnwOAHwlGFzW-D-uEC9x_GQcKjYmfFdIIpWwf_rytw4YnfI_nHb5pTuQZmuDulS8eU5CkUsor4_eDN8faIBq0RtLPWrOXXcQpX7Hp_Aq8EVwf3GSLvQyKSOEYbu0KF59rcu73KdyCT4C2x4=w1202-h599-no\" alt=\"In the background, a Chrome window with a single tab showing a blank page. In the foreground, a Chrome DevTools showing the error mentioned above.\"></p>\n<p>It turned out, however, that specifically the <code>navigate-to</code> directive was not supported yet at all, in any browser, at least <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/navigate-to#browser_compatibility\">according to MDN</a>. However, in the <a href=\"https://source.chromium.org/chromium/chromium/src/+/8549a61f550a6ef53e2191f66058a6c900237deb:out/android-Debug/gen/content/public/common/common_java/generated_java/input_srcjars/org/chromium/content_public/common/ContentFeatures.java;l=198-202\">Chromium code</a> the following could be found:</p>\n<pre class=\" language-cpp\"><code class=\"prism  language-cpp\"><span class=\"token comment\">// Content counterpart of ExperimentalContentSecurityPolicyFeatures in</span>\n<span class=\"token comment\">// third_party/blink/renderer/platform/runtime_enabled_features.json5. Enables</span>\n<span class=\"token comment\">// experimental Content Security Policy features ('navigate-to' and</span>\n<span class=\"token comment\">// 'prefetch-src').</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> final String EXPERIMENTAL_CONTENT_SECURITY_POLICY_FEATURES <span class=\"token operator\">=</span> <span class=\"token string\">\"ExperimentalContentSecurityPolicyFeatures\"</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>Turns out I had the <code>#enable-experimental-web-platform-features</code> <a href=\"https://www.chromium.org/developers/how-tos/run-chromium-with-flags/\">flag</a> enabled, for some reason, and that flag probably included the <code>EXPERIMENTAL_CONTENT_SECURITY_POLICY_FEATURES</code>. I probably enabled the flag for development at some point? I do not even remember. But that meant the <code>navigate-to</code> directive was just wrong.</p>\n<p>Since I did not want to disable the flag (or were not sure whether it would help), I instead turned to <a href=\"https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj\">ModHeader</a>: a Chrome web extension to modify requests and responses in the browser. I mainly use it to view <a href=\"https://citation.crosscite.org/docs.html\">DOI content negotiation</a> requests in the browser instead of using cURL. With that I could modify the <code>navigate-to</code> part of the <code>Content-Security-Policy</code> header to the following (line breaks and <code>[...]</code> mine):</p>\n<pre><code>Content-Security-Policy: [...] navigate-to 'self'\nhttps://*.universityfoo.nl:443\nhttps://*.services.universitybar.nl:443\nhttps://brightspace.universitybar.nl:443; [...]\n</code></pre>\n<p>This finally allowed me to log in to Brightspace.</p>\n<p>Naturally I wanted to share my findings, especially since whenever <code>navigate-to</code> gets support without experimental flags, Brightspace log in breaks for <strong>everyone</strong>, so I went to the online university helpdesk. There, I was also met with a blank page. Imagine that. Suddenly logging in to Brightspace does not work anymore, and all the students going to the digital helpdesk are met with a blank page as well. Students panicking, the IT department (maybe) panicking because <em>they</em> were not doing any upgrades or maintenance or <em>anything</em>. Good thing I got a sneak preview of the problem, so I could warn them. First, bypassing <code>navigate-to</code> for the helpdesk as well:</p>\n<pre><code>Content-Security-Policy: [...] navigate-to 'self'\nhttps://*.universityfoo.nl:443\nhttps://*.services.universitybar.nl:443\nhttps://brightspace.universitybar.nl:443\nhttps://helpdesk.universitybar.nl:443; [...]\n</code></pre>\n<p>However, when I sent a message detailing the problem, I was met with “can you try clearing your cache?” I did, even though I knew that was not the problem, and it did not help. I did know what <em>would</em> help though, but they clearly did not care since I am reproducing the problem while writing the blog post almost 9 months later. When I confirmed that clearing the cache did not help, I was asked to disable <code>#enable-experimental-web-platform-features</code>. Which, sure, but that was not really the point. Anyway, I guess they will probably find out in time anyway, but I was still a bit disappointed.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-6205867043285272121","title":"Citation.js Version 0.5 and a 2022 update","link":"https://larsgw.blogspot.com/feeds/6205867043285272121/comments/default","published":"2022-05-27T17:46:00.002+02:00","description":"Version 0.5.0 Version 0.5.0 of Citation.js was released on April 1st, 2021. BibTeX and BibLaTeX After the update to the Bib(La)TeX file parser, described in the earlier BibTeX Rework: Syntax Update blog post,...","isPermalink":false,"tags":["bibliography","BibTeX","Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:45:54.216+02:00","contentHtml":"<h3 id=\"version-0.5.0\">Version 0.5.0</h3>\n<p>Version <code>0.5.0</code> of Citation.js was released on April 1st, 2021.</p>\n<h4 id=\"bibtex-and-biblatex\">BibTeX and BibLaTeX</h4>\n<p>After the update to the Bib(La)TeX file parser, described in the earlier <a href=\"https://larsgw.blogspot.com/2019/10/bibtex-rework-syntax-update.html\"><em>BibTeX Rework: Syntax Update</em></a> blog post, the mapping of BibTeX and BibLaTeX data to CSL-JSON was also updated. The mapping is now split in two, one for BibLaTeX (which is backwards-compatible with BibTeX) and one for BibTeX. The output formats were also updated to output either BibTeX-compatible files or BibLaTeX-compatible files. The most common difference there is the use of <code>year</code> and <code>month</code> versus <code>date</code> respectively. In addition, a number of updates were made to the file parser.</p>\n<h4 id=\"core-changes\">Core changes</h4>\n<p>In the <code>Grammar</code> utility class, bugs were fixed an behavior was updated to better account for the Bib(La)TeX parser. Some of the code for correcting CSL-JSON was also updated, including moving the code correcting results of the Crossref API from the DOI plugin to the core module as CSL-JSON from the API may end up in Citation.js through other methods than the DOI plugin. Earlier in 0.5 development, some of the HTTP handling code was also updated for increased stability.</p>\n<h3 id=\"update\">2022 update</h3>\n<h3 id=\"v0.5.1–v0.5.7\"><code>v0.5.1</code>–<code>v0.5.7</code></h3>\n<p>The version released since <code>v0.5.0</code> mostly contain bug fixes and small enhancements. The latter includes some more descriptive errors in certain places, as well as mapping some non-standard fields in Bib(La)TeX and RIS.</p>\n<h3 id=\"new-site-design\">New site design</h3>\n<p>The design of the Citation.js site was updated for the first time since 2018. The changes were detailed in the recent <a href=\"https://larsgw.blogspot.com/2022/05/citationjs-new-site.html\"><em>Citation.js: New site</em></a> blog post.</p>\n<h3 id=\"new-plugins\">New plugins</h3>\n<p>New plugins for the <a href=\"https://en.wikipedia.org/wiki/Refer_(software)\">refer</a> file format (<a href=\"https://github.com/citation-js/plugin-refer\"><code>plugin-refer</code></a>) and the <a href=\"https://en.wikipedia.org/wiki/RefWorks\">RefWorks</a> tagged format (<a href=\"https://github.com/citation-js/plugin-refworks\"><code>plugin-refworks</code></a>) were released.</p>\n<h3 id=\"more-coming\">More coming</h3>\n<p>More changes are expected, including more long-awaited output formats, better mappings for software and datasets, and more work on machine-readable mappings.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-7165986131983725879","title":"Citation.js: New site","link":"https://larsgw.blogspot.com/feeds/7165986131983725879/comments/default","published":"2022-05-27T16:53:00.002+02:00","description":"Citation.js: New site    I recently updated the website of Citation.js. This involved getting rid of the Material Design Lite framework, simplifying and refreshing the site design and modernisering some...","isPermalink":false,"tags":["Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:46:01.844+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: New site</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>I recently updated the website of <a href=\"https://citation.js.org\">Citation.js</a>. This involved getting rid of the <a href=\"https://getmdl.io/\">Material Design Lite framework</a>, simplifying and refreshing the site design and modernisering some of the code behind it. Additionally, I updated the content of the homepage, and added some functionality to the interface of the blog page and the demo.</p>\n<h3 id=\"homepage\">Homepage</h3>\n<p><img src=\"https://lh3.googleusercontent.com/2e23ECyvnyzJBUyVglavqwwslbVe5wIygKSIluf2lmbEF_a3EjG-TeygrkCEZFIFg5i8rk5Fj1iYQXgBriZ3NAw3hjJGUo__N7AisFJis7sHo1Ax7pv1GH5NPHr0snOBLrS7n0ONidw_4jSpjD6309f21WtrBV_tHFwdNT442e-sgmdtIsBUj01XCWMEuDedDiHfu64rojK8v5_8blyzdCs8y7IHBE6jxKeWcobXn7OJWOzqqHNGdvDRXiDJmAEP5bLoGN55eu00DaYNoZix6UJsAmiwlwNyTq0im8mcxVZCRGW5_Z068CeIoedbkmK6z0DlN0VSNR9b-PahiY3v5q4Z-P3spFcksbAq0k23DCybTL9x3teXOyRXuQlkhrM1lY89sR0EmB1MdlBuUE4mi8O4mIiB40-VRWt_opCgjby6YWV9u7ulbN4vGqQ-X1tCTCEMBA2zSiFZ0JrhB_G-cE0lHNCfUKy8lWr1e5R0ZLsdQ-cpfoVGHw4jYgd5UGEtH6uHE5R2_HsBG2o4PPJ0_tDjeHYIAkp0Mg0ce1yd_n0KNiU8JJP1qFnJGp74Y3HiVd0z27QFr6UCy9D2MOtOxMRw0fI-AyAn5A4UdOFrINHtYFUC9in1BtVxoezWtNxfiwEQN_RT8v0iozjE37SFI55i3Us0cOlCRESayvBOnGaUo17AYa6ha-RbrT2GuLupqxEfp_U6d0hCm3NtQfSdSTUtMR7ix4FG0_uCxiVwUsXkBWyYdM1o1rsj2kFw=w1479-h977-no?authuser=0\" alt=\"\"></p>\n<p>The old layout of the homepage had a dark grey background, with in the middle a grid of four cards with the main content of the site, and between the top and bottom row the Citation.js banner-variant logo. The grid of cards had a  background of syntax-highlighted source code. This is actually the start of the Citation.js v2 code, which at that point still consisted of a single file. On the very top of the page was a yellow header and in the bottom a thin black footer.</p>\n<p><img src=\"https://lh3.googleusercontent.com/K_XI74517ZyQdhYWuoCiD-K2QtY-_F1DUZco54JOqjQfg_dGGSz0ys_S-NV_S9Sq3WZWsypgVj0pFXSySQnyk_S36Vataf2nDwUanuLLHYef8YMeK4D13dDPWZyzqFsJKn_tZI_tI4DMTVa2MypCyCb_IpwTcPN29eespjh7Hr-tZ5rf9VuoZXGHWplKMFa1omv_9-zOMqLAi41tIRUWV3gU_Si2JmvFcYuX3DKFd2czqDxxg-rdDkbBkgUXKXa6PnL66kDUaNQK9qHLE35Xrik0Agd9t9MeRGYR2Wx9aJhRbm82C8WAeSttfdhLbNtFl_PbIK9Ajg4RVVvZV_ozaA4ZRYLETNHFHvXMaMVvTV_Urt5BJDq3S0LbEMocLT1Ue9HFzVro7J6iqOOGORXZL25TN3zpyU3R89Orob0Ap8ydQwLophBUdMm3W0bUN4gaHeXNaJ1w5VzEtzA4iqTkooWKyDO6jEWuxiE8lkSFfeQ49vuUuxdX1c39_yJ_egdSoX4enLCKSzSLMEM53yo28S9Ic-P47zLuwDUwb-txGcUJxM0TBWg-RjsSHS-trWjI_QTesRAwsC3T9vPg5x3WvqfDfXqyrcktPTqtYz3VHLf1nEM1ht-iuB0M8LsmhPg6YnuUHT3qhvcM99ZVQMDEi7XGvOIa0DXblS8YLS1c2gmJxnq8PvqdeA4mVmdfAszG-paqpxM8lvc5gGz28TEzM5dIAislIsrh4boUHP1tYRkADaYV5Y6NQWXJjYGF=w1521-h978-no?authuser=0\" alt=\"\"></p>\n<p>The new layout incorporates a lot of the design elements of the first design, but in a way that hopefully improves the readability and feel of the page. The yellow header remains but the links are centered instead of right-aligned. The footer is full-width (though the text is still centered) and has a larger font size and vertical padding. The grid is gone, instead the top of the page has a background of code in full-width with the banner logo and some introductory text. The other content is now aligned in a single row, and the cards are replaced with plain text, although the headers still have white text with a slight shadow on a dark background.</p>\n<h3 id=\"blog\">Blog</h3>\n<p><img src=\"https://lh3.googleusercontent.com/6aJPXYUAdeNU2nxf3KyuAsRRjLPROmwuuz6e1lE2LzTA4xbC1jMXsoJ983Url2Q7312yOpBsC8mMSxSIXIMY8SP8d2Jp3xMfJR1u_rCcJmoT9hL1xXlqNXkcvC3wBd90Odb5iOW34X7uECKbd-Pp6AxHw8-rSV9dgzYsiiqk9frJsm4RmnXFBgj8YoyWpTx5ntOpvjLpfqeXNRFBQvqBcmYqDz7ZyY_Ob0QZLU9UaW9PI5rjZCrj588p5u4d6qNveB7Eof8t6Jf7cdYRIa0PARkzcKrTFHQ-cy0CLRICpycNX7X1BSLK68VnuaZWGJf4AFUAfJvCSiYa3vtS6WsVwU3h3f7c6Pg0MJMHGtXOcqFxDWV5Z8nJ0_qc9bETmzPzfn6r6q1TtM9B703Zg99Bc6LnFL0yVrF6ZTB5pP5T5zVmlRfjVu2uBpqUp_X-bfDLnuulyHWcahbf91dHJQlPiDGv3qFdw2iAUaCwArpJR5CyY8_cZTrfwmmB1OfLLZT2jEi1ADq4qEcLNOu1QbKu2cEfekQX8oOVIsiqcICK3y9tUIqSWoXjHH7fMBMx4rtUGZTxwa-Y0s6a0yxydKyXrGsvte715JSGgxkRMR0OKveuVPiji-1a_zw44FHTnsu8cdTH3qLVGyPyO5i_Oixt4onS9G5XI947IsdVCm0HJvDnS2HODB3-GAYLTs5X_zOfrZm9NOEhF3wDUNYFp69WFK8LCfI1y6_u3l0DlzSmJ8JkROUk2l-nztxYTFmy=w1920-h941-no?authuser=0\" alt=\"\"></p>\n<p>The blog page had the same header, footer, and dark grey background in the old layout, with individual blog posts as cards and the introductory text and search bar as a slightly wider card.</p>\n<p><img src=\"https://lh3.googleusercontent.com/z2l78IL-t6m8EHhbmshAfEk_gk3RW2Axh6Sk8pGiHVKW3f6URUWVBklx8Q6q363pGORlYKCDi8FCeQPYWWSjkGcRGIXbTLoiduIOcKj8A1RvyK6kTgGmqLJX79tlGlhZy36tEXazhHkH_uggYbbB9OzgDaWtktgOSQul0raJsnkMLCe4lBBxxc6bgRpS6zW1RFrdzGCqEWUM0ubFiL6GSUjya4OM5AE7pXINitqezFhNa6affKPnE_1gBgs4_t0nAqyQqhu700tHIYnfzQLr7DFiHFJO_9RwvA4JG0pUw-_58e9yl75zw6NxLNx9T90oaXEOdhlgHbXjLXwrGludwBVzD3b6_NiKnVAU6l2kvX4BoGaki6OozGMdrgO4sNcldBS5l_eQsezmvAu2QWWcWGVn_F1LB4kkGAcLQmDYXWEtcO0SKApYW8QWCsA9OimW1xruCcbgZ9eXjuLsoo31LkqnZZe3Dx2nL8d8an30RwACzxDvuLJ02JqbqvOPCx7tFzfrItWijxwDI8Acdu0YYKuTbg9KRlTIdhMLcxG5biMzeWA5xODamXuKb2zKsZQyKIaWyfXd6Eq0_URWVfgfSv35PTHwdUHljusV5aULkPzTN0xvkm3WmA1V51jqMb0wKNxS6lJ9MdwDCaQT-RzgVxiXCOCVBudGZ1vj2736JPzHd5naettnf6_ZlMqhp7Go_kmuwKTbV-8gKi_tZ3rOeWzxwpPFyt58awN5yVs43Hikl3o0abWsoEuN4Qua=w1920-h878-no?authuser=0\" alt=\"\"></p>\n<p>The new layout mirrors the changes to the homepage, especially the white background and full-width code background and the changing of cards to plain text. To the right of the blog content is now a sidebar listing the blog posts per year, which moves to the bottom of the page on narrow screens. Below the search bar is now a clickable list of tags.</p>\n<h3 id=\"demo-page\">Demo page</h3>\n<p><img src=\"https://lh3.googleusercontent.com/2JXvid0CEcf5iEAoAbtDePM_zx1WTnbfDR6qxr0pmZzpdjh3rKd7Tup36syx281nQ1MocCqRj5XznNu-tGz5SCFIb1EUel6vehk8e0miK6-5ffCgGQokf2hMLj4dnUcAzntg-uNAag53uYdSXyhIeod1NVn7QSPPO0qTNsquwFjZ_msHStLqNIRIYkwmL72JoEJZBifaG2BMMhBP617-aTIOc6TcqkNJBUWuPSJwT9Gj3v68S7jHuM0PGeKXyVKXTkqdUDyKwvTXbS6JzUqbdXhTUuXQ62swyGIPkqV9czXieefUrR51MogA7gkfB5mZHXn6Na-j-AoppkBrMvqbJvdSAhKmn7JCfM2PaRpJ8rBYhzsHtv7W0DR19XTg7tY77---F1RmafuCUYf66-rk61FJOv_UCJm8a5katOLbxm9t6KibAEpI9HcYZRbttkSBVGjYc3RuasgtgD2qrzKDkaJAeGbV3SrDVfGOx5W4DutUduUEcW_K_xt30ju-Xal5rAxxs8MZZ26xraPIfqxRg8XNNxeIvosR56jTJCnltQIfguZr453FcqQoOUtVCb_pmysEsDD5Qs3TvPKUTzWm9Rn0sU36Uiuxi6V5IsAgK7__qfcxZDbpMWV8JDhJX5kxSVplDHAJBnk5jvEeesbYlzwiw_crgMakEjRkfZgqJWB0DoTzpXf4gO_Cnt3ldhd0RMOyhRUEKD1RQgaqzbqwJL1d3SACec4FUaPFT2AnQ6_hDLptSbFfrUbleRge=w1920-h878-no?authuser=0\" alt=\"\"></p>\n<p>The design of the demo page has not been updated since I made it in <a href=\"https://github.com/citation-js/site/blob/4dca94389f9e1dc9e359a8f7a8f0c2ce83d3c98b/demo.html\">April 2016</a>, being more or less plain-text but with paragraphs limited in width and centered.</p>\n<p><img src=\"https://lh3.googleusercontent.com/Ybul5si5Bhbmbouh0VuFVoljQOLLF0tmvH0swXkW4CMlznN49cvBLzhvDvZ_zJNs6sb5TSRUGwueMMiZ4L2HJyTPl34Ff_3R5Jr254-uHAXgju7j4GvsJbuHwHdYvJTc_8jbSMtLOLjYhdRPnQehGSbqC5rqSRSA9tkaItD2990y8iaaPr70Vzva6lzh64XPZttT9LpjZQ167I19K9oC85RbEJTdxg0dLyz3ovhkNvS5xmj7ROGNRHYDznki0aIsSY99Lk6_bc7iMqZ5mXSE7IcXgDrKFozg4Zhz0tFr8uLHjnA1kaU4VJqXYKYmnG1wyICW4nihFuOv5QkUjvxeL0f0uMQMhXAbufvlqNhpfOe3NoF8Hts7pbuWiQ1G1w_h1TfpqlhBKGiY0bI7oAfgYhPk9QWJS-m3KtTd3aAxZxRWg06SFEPYiMyaIJxElqjTT-EOkETZYtuEfzUeNqu6IWYws1wYMy1JK6G5JVXiGaWAdr0TntgZpbEVm1nY1FdP5DcPAKMZBoj91YKFQuLNlW0K2eVrc9IwLx0hPYasvQ_e1paRzZKy2KhkciUMgA-QdXVLh3NGEqbBORVFeyZPX9chNXsbr9cUPVcBWRTIpK0v_bdl_Itzm06BoFl8ypzxhK6VUg9GLQU8GTxqz6zQ89pO6RJ-MCuxVDM01DJ4dI5rX2_ssLEl0ED-G5S0qTTxxfVHHBvmui-E-mV7DszKc9pKWPgbTo8wQtYBSYJR3bNtpz0Oz2hK3jLEIdln=w1920-h941-no?authuser=0\" alt=\"\"></p>\n<p>The new design adds the header, footer, and code background from the homepage as well as some styles for the headers. The interface of the demo is simplified at the cost of easy-to-read code. That also means that the live view of the code is removed.</p>\n<h3 id=\"api-documentation\">API documentation</h3>\n<p>The styles of the home page now also apply to the API documentation.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-1229895909962176479","title":"GitHub pages 404 redirection","link":"https://larsgw.blogspot.com/feeds/1229895909962176479/comments/default","published":"2021-03-26T14:08:00.002+01:00","description":"Recently I moved the Citation.js API documentation from /api to /api/0.3, to put the new documentation on /api/0.5. I fixed all the links to the documentation, but I still got a issue request regarding a 404...","isPermalink":false,"tags":["Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:46:06.890+02:00","contentHtml":"<p>Recently I moved the <a href=\"https://citation.js.org\">Citation.js</a> API documentation from <code>/api</code> to <code>/api/0.3</code>, to put the new documentation on <code>/api/0.5</code>. I fixed all the links to the documentation, but I still got a issue request regarding a 404 error after just a few days. All in all, I had to redirect pages from <code>/api/*</code> to <code>/api/0.3/*</code> while all these pages are hosted as static files on GitHub Pages.</p>\n<p>There are three ways I found to do this:</p>\n<ol>\n<li>I make otherwise empty HTML files in <code>/api/*</code> that redirect to <code>/api/0.3/*</code> via JavaScript or a <code>&lt;meta&gt;</code> tag.</li>\n<li>I make use of <a href=\"https://github.com/jekyll/jekyll-redirect-from\"><code>jekyll-redirect-from</code></a>. This is equivalent to option 1, I think.</li>\n</ol>\n<p>Option 1 seemed like a hassle and I do not use Jekyll so option 2 seemed out of the question as well. However, we still have option 3 to consider:</p>\n<ol start=\"3\">\n<li>I add a <code>404.html</code> to the repository which gets served automatically on a 404. It then redirects to <code>/api/0.3/*</code> with JavaScript, and gives guidance on how to find the new URL manually if JavaScript is disabled.</li>\n</ol>\n<p><code>404.html</code> is just a normal 404 page with 4 lines of JavaScript:</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\"><span class=\"token keyword\">var</span> docsPattern <span class=\"token operator\">=</span> <span class=\"token regex\">/(\\/api)(\\/(?!0.[35]\\/)|$)/</span>  \n  \n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>docsPattern<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>docsPattern<span class=\"token punctuation\">,</span> <span class=\"token string\">'$1/0.3$2'</span><span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>Breaking down the RegExp pattern:</p>\n<ul>\n<li><code>(\\/api)</code> matches “/api” in the URL</li>\n<li><code>(\\/(?!0.[35]\\/)|$)</code> matches one of two things, immediately after “/api”\n<ul>\n<li>Either <code>$</code>, the end of the string (like “<a href=\"https://citation.js.org/api\">https://citation.js.org/api</a>” without the trailing slash)</li>\n<li>Or <code>\\/(?!0.[35]\\/)</code>, which matches a forward slash (\"/api/\") followed by anything except “0.3” or “0.5”. This is to avoid matching things like “/apical/” or “/api/0.3/does-not-exist”.</li>\n</ul>\n</li>\n</ul>\n<p>This is not the neatest solution but I like it conceptually. It shows a bit of potential for Single-Page Applications as well: you can serve the same HTML+JavaScript for every possible path without having to rely on URLs like <code>https://example.org/#/path/page</code>. The problem is that you still get the 404 HTTP status (as you should), so if a browser or search crawler decides to care you have a problem.</p>\n<p>Try it out now: <a href=\"https://citation.js.org/api/\">https://citation.js.org/api/</a></p>\n<p><img src=\"https://1.bp.blogspot.com/-srnQgvIYR1c/YF3aOogA3AI/AAAAAAAAuro/gVpFdn1m-Gk4JBh9Nsrw6Gd_bR-QKApEACLcBGAsYHQ/s0/citation.js.org_api_0.3_test.png\" alt=\"The new &quot;Page not Found&quot; page in the same style as the homepage.\"></p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-6660311785519342180","title":"Mid-week effect of Dutch COVID-19 case reporting","link":"https://larsgw.blogspot.com/feeds/6660311785519342180/comments/default","published":"2021-02-24T19:10:00.002+01:00","description":"Every week since the start of January I heard headlines like “3963 new infections, a bit more than average”. In context, that meant that the amount of positive COVID-19 that day was higher than the average...","isPermalink":false,"tags":["statistics"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:06.486+02:00","contentHtml":"<p>Every week since the start of January I heard headlines like <a href=\"https://nos.nl/artikel/2367703-3963-nieuwe-besmettingen-iets-meer-dan-gemiddeld.html\">“3963 new infections, a bit more than average”</a>. In context, that meant that the amount of positive COVID-19 that day was higher than the average daily amount of cases in the previous seven days. Even though we heard that every week, overall the cases were going down. What was going on? Well, somewhat unsurprisingly, the amount of reported cases was higher on weekdays than on Monday and in the weekend. The news site I linked above <a href=\"https://nos.nl/artikel/2366222-leeswijzer-hoe-maak-je-chocola-van-de-dagelijkse-lading-coronacijfers.html\">mentions the midweek-effect</a> as well, but on Twitter and on the radio you mainly hear the headline, not the caveats.</p>\n<p>Anyway, I wanted to see what the midweek-effect actually looked like. The daily infection data is <a href=\"https://www.rivm.nl/coronavirus-covid-19/grafieken\">available from the RIVM website</a>, RIVM being the Dutch National Institute for Public Health and the Environment. I started by reproducing the graph they made, partly to check the file and partly for fun (see Fig. 1).</p>\n<p><img src=\"https://1.bp.blogspot.com/-3WaegESqpw4/YDWA7Fpl-hI/AAAAAAAAti0/FnM2yq15kqw7wJZYnTPYM0hDpBLVSHWQACLcBGAsYHQ/s0/cases.png\" alt=\"Amount of new cases on each GGD notification date\"><br>\n<strong>Figure 1: Amount of positive COVID-19 tests since the start of December.</strong> The date used is the date when the test result was reported to the GGD, the municipal health service. In yellow are the test results RIVM got this week, in purple previous data.</p>\n<p>To decompose the various effects in this data, I used R’s <a href=\"https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/stl\"><code>stats::stl()</code></a> function on a time series with <code>frequency=7</code>. This took a while to figure out, as a mis-configuration on my end of the time series led to STL interpreting each day as a season, instead of each week. Because the seasonal effect is multiplicative and not additive, I had to log-transform the data as well. This means the seasonal component has a higher amplitude when the overall amount of cases is higher (see Fig. 2).</p>\n<p><img src=\"https://1.bp.blogspot.com/-CLKzM-chP2E/YDYWTpkt01I/AAAAAAAAtjE/3Y3rpa8oLxcYCyHKCZ9sxj-GKUESZbWeACLcBGAsYHQ/s0/trend.png\" alt=\"Seasonal component and trend of data previously shown\"><br>\n<strong>Figure 2: Weekly component and general trend of positive COVID-19 tests</strong>, overlayed on daily data. The solid line indicates the overall trend, while the dashed line combines the overall trend with the seasonal component. Yellow still indicates test results from this week, purple the previous data.</p>\n<p>In the end, this does not mean much at all. The accepted explanation of the midweek-effect has to do with when tests are carried out and reported; not when infections actually take place. If we look at the cases where the date of disease onset is available (<a href=\"https://data.rivm.nl/geonetwork/srv/dut/catalog.search#/metadata/2c4357c8-76e4-4662-9574-1deb8a73f724\">source</a>, <a href=\"https://creativecommons.org/publicdomain/mark/1.0/deed\">Public Domain Mark 1.0</a>), the weekly trend is less present (see Fig. 3).</p>\n<p><img src=\"https://1.bp.blogspot.com/-fHByp58AOyQ/YDaKuSdNA3I/AAAAAAAAtjg/yGgDXIEM5W0OBYb5-OcpQ0FRWSGTz64vgCLcBGAsYHQ/s0/trend2.png\" alt=\"Seasonal component and trend of new cases per day of disease onset\"><br>\n<strong>Figure 3: Number of new confirmed cases per day of disease onset.</strong> The solid line indicates the overall trend, while the dashed line combines the overall trend with the seasonal component. The gray area show daily cases.</p>\n<p>Comparing the two weekly trends, the midweek-effect of reported cases is higher than the weekly effect of the disease onset of cases. In addition, the latter peaks on Mondays and declines throughout the week before as opposed to the midweek-effect (see Fig. 4). Whether this effect is actually present or another artifact of data reporting is unclear to me.</p>\n<p><img src=\"https://1.bp.blogspot.com/-x1wChmjNQrA/YDaViNF6-1I/AAAAAAAAtjw/A8mExpUtMec2CGSvap2Axtx-bJYXT7-NQCLcBGAsYHQ/s0/patterns.png\" alt=\"Weekly pattern of GGD test results and reported disease onsets\"><br>\n<strong>Figure 4: Weekly component of reported cases and disease onsets.</strong> The solid line shows the pattern for the day of disease onset, the dashed line for the day when the test result is reported.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-5162429891713307926","title":"Economics of open source versus open science","link":"https://larsgw.blogspot.com/feeds/5162429891713307926/comments/default","published":"2020-03-23T16:40:00.002+01:00","description":"Common postman (Heliconius melpomene) on a Lantana Almost two years ago I started participating on the then-new (now-archived) npm forum. I had been using npm for a few years at that point, and I had some...","isPermalink":false,"tags":["programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:46:36.777+02:00","contentHtml":"<p><img src=\"https://lh3.googleusercontent.com/saNvSR2_xkDNAkKpUvtmfkq5CPgDob5zdYRPWcUwpDcBWJPcK_ZEJ6FxEAstyozxtx_PxumKnXAEbw\" alt=\"Common postman\"></p>\n<blockquote>\n<p>Common postman (<em>Heliconius melpomene</em>) on a <em>Lantana</em></p>\n</blockquote>\n<p>Almost two years ago I started participating on the then-new (now-archived) <a href=\"https://npmjs.com\">npm</a> forum. I had been using npm for a few years at that point, and I had some free time to spend providing technical support, for fun. I fixed a number of bugs in the CLI, and users thanked me for those.  My impact was limited, but the work was fulfilling. That is, until the developers at npm I had been working with got laid off.</p>\n<p>Later in 2019 came the second hit: shortly after <a href=\"https://www.zdnet.com/article/popular-javascript-library-starts-showing-ads-in-its-terminal/\">a popular JavaScript library started displaying ads</a> to fund maintainers raised a ruckus on Twitter, npm started banning terminal ads. The ensuing chaos was a wake-up call for me. Lots of people started talking about the economics of open-source development, suggesting that open source is a fake ideology propagated by tech companies in Silicon Valley to generate value at no cost — to the companies, that is.</p>\n<p>We were putting hours and hours of work into some ideology, and the corporations that profited from our open-source libraries gave us nothing in return. Everyone keeps laughing about the enormous dependency trees of Node.js projects, but that also means every project depends on <em>a lot</em> of other open-source projects, mostly by unpaid maintainers. Similarly, the bugs that I fixed for the npm CLI had a very small impact in the grand scheme of things, but npm is used by almost every company that uses JavaScript — most likely including Google, Amazon, Apple and Facebook. And a small percentage multiplied by almost all the tech capital in the world is still quite a lot.</p>\n<p>This contradicts with what I have been taught about Open Science: ideally, all aspects of all science should be open to everyone, to allow small players to take part. The more small players can take part, the better the science is, both morally and in quality &amp; quantity.</p>\n<p>While in the tech world, a small but vocal group is trying to bring about a revolution to rethink open source to help the individual, at the same time the science community has just gotten into the idea of expanding open source — again, to help the individual. Is open science just a few years behind open source?</p>\n<p>One important thing to note is that both revolutions are trying to bring about the same thing: fair representation. In fair open source, this is about maintainers of public infrastructure (in the form of libraries) getting part of the profit generated by companies using it. In open science, this is about letting everyone take part in science, from people without affiliation to people whose institution cannot or does not want to pay for access, and lowering the barrier by making source code and data available.</p>\n<p>The main difference is probably that scientists usually get paid, at which point it is easier to choose whether to make your work open or not: not making it open would be a waste. Additionally, there is the notion that any science is good for science (and the world) as a whole: even if commercial pharmaceutical companies get to use open research (and open source software) from researcher that they did not fund, advances in pharmaceutics are good for everyone. Plus, open science helps the smaller players, which would be beneficial for competition and so prices (if market forces finally follow through).</p>\n<p>In the middle of this is me. I maintain an open-source project (<a href=\"https://citation.js.org\">Citation.js</a>) aimed at people who care about bibliographical data — e.g. scientists and librarians. It has 142 stars on GitHub. I am proud of it. Neither side really applies to me: I cannot think of any commercial application that <em>needs</em> my library, nor do I receive funding for working on a (very small) part of the scientific community. So, which revolution should I follow? Fair open source or open science?</p>\n<p>At the moment, I am fine with keeping it as it is. Though tiresome, it is also fulfilling, and right now I can still use the Exposure™. For the longer term, I guess I will naively carry on until I burn out or someone convinces me otherwise.</p>\n<hr>\n<p>Note: a proposed solution for fair open source is <a href=\"https://licensezero.com/licenses/parity\">the Parity Public License</a>: it allows people to use it in private without limitations, and otherwise it requires the project using it to be open-source as well. Additionally, it is possible to buy licenses for closed-source work. To me, it seems a bit limited. Licenses like this can quickly become complex to use. Do I want people to be able to use Citation.js on their personal website without making the website open source? I do not think that would be possible with this license, without personally giving permission to people who would want that.</p>\n<p>There are probably better blog posts to be read about the trade-offs of such licenses. If you find any, I will add them here.</p>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-2671087865137010007","title":"BibTeX Rework: Syntax Update","link":"https://larsgw.blogspot.com/feeds/2671087865137010007/comments/default","published":"2019-10-11T23:29:00.002+02:00","description":"BibTeX Rework: Syntax Update    A rework of the BibTeX parser has been on the backlog since at least August 15, 2017, and recently I started working on actually carrying it out — systematically. There...","isPermalink":false,"tags":["bibliography","BibTeX","Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:46:56.688+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>BibTeX Rework: Syntax Update</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>A rework of the BibTeX parser has been on the backlog since at least <a href=\"https://github.com/larsgw/citation.js/issues/56\">August 15, 2017</a>, and recently I started working on actually carrying it out — systematically. There were a number of things to be improved:</p>\n<ol>\n<li><strong>Complete syntax support:</strong> again, supporting BibTeX by looking at examples leads in a lack of support for less seen features like <code>@string</code>, <code>@preamble</code> and parentheses for enclosing entries instead of braces.</li>\n<li><strong>More complete mappings:</strong> since I did not have any specifications when making the BibTeX parser, I could not find a complete list of fields, hence no complete mapping.</li>\n<li><strong>Distinction between BibTeX and BibLaTeX:</strong> although there may not be any problems when importing, using <code>year</code>/<code>month</code>/<code>day</code> or <code>date</code> matters a lot if you have to output either.</li>\n<li><strong>Proper schema validation:</strong> BibTeX defines required fields, but Citation.js does not check if those all exist.</li>\n</ol>\n<p>In this blogpost, I will describe how I went about solving the first point: complete syntax support. Part of the problem was that I was running a bad parser, which was difficult to extend and not performing that well.</p>\n<p>To improve this, I <a href=\"https://github.com/citation-js/bibtex-parser-experiments/\">collected a number of BibTeX parsers</a> to compare them on a number of criteria: performance, syntax support, build steps, and ease of maintaining. I used two single-entry BibTeX files for debugging, and a longer BibTeX file (5.2 MiB, 3345 entries) for some rough performance testing. The outcomes:</p>\n\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Using</th>\n<th align=\"right\">Time (single entry)</th>\n<th align=\"right\">Time (3345 entries)</th>\n<th>Syntax</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Current</td>\n<td><code>TokenStack</code></td>\n<td align=\"right\">~8ms</td>\n<td align=\"right\">~1800ms</td>\n<td>old</td>\n</tr>\n<tr>\n<td>Idea</td>\n<td><a href=\"https://github.com/no-context/moo\">moo</a>, <code>Grammar</code></td>\n<td align=\"right\">~2ms</td>\n<td align=\"right\">~1150ms</td>\n<td>old</td>\n</tr>\n<tr>\n<td>Idea (new)</td>\n<td>moo, <code>Grammar</code></td>\n<td align=\"right\">~3ms</td>\n<td align=\"right\">~750ms</td>\n<td>new</td>\n</tr>\n<tr>\n<td>Generator</td>\n<td>moo, <a href=\"https://nearley.js.org/\">nearley</a></td>\n<td align=\"right\">~20ms</td>\n<td align=\"right\">N/A</td>\n<td>new</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/dsifford/astrocite/tree/master/packages/astrocite-bibtex\">astrocite</a></td>\n<td><a href=\"https://pegjs.org/\">PEG.js</a></td>\n<td align=\"right\">~9ms</td>\n<td align=\"right\">~1670ms</td>\n<td>new</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/fiduswriter\">fiduswriter</a></td>\n<td><a href=\"https://www.npmjs.com/package/biblatex-csl-converter\">biblatex-csl-converter</a></td>\n<td align=\"right\">~160ms</td>\n<td align=\"right\">~119000ms</td>\n<td>new</td>\n</tr>\n<tr>\n<td><a href=\"https://zotero.org\">Zotero</a></td>\n<td><a href=\"https://github.com/zotero/translators/blob/master/BibTeX.js\">BibTeX translator</a></td>\n<td align=\"right\">~180ms</td>\n<td align=\"right\">~31000ms</td>\n<td>old</td>\n</tr>\n</tbody>\n</table><p>So, the current parser was performing pretty well actually, especially compared to astrocite which I still consider a good target to aim for. <code>TokenStack</code>, however, was an unnecessarily complex part resulting in poor performance — and poor maintainability.</p>\n<p>I had some trouble with PEG.js so I turned to other approaches. One thing I came across was nearley. However, this would introduce both an extra build step <em>and</em> an extra run-time dependency, and as the table shows did not perform very well. I assume that is on me, and my grammar-writing capabilities. One good thing that did come out of it was the use of a tokenizer or lexer, like moo.</p>\n<p>After nearly finishing an approach using moo and <code>Grammar</code>, a simplified version of <code>TokenStack</code> with built-in support of rules, something else came up and I dropped the subject for about a year. However, recently I started over, saw my old approach and copied some stuff from there. This resulted in a even more simplified <code>Grammar</code>, with only <code>matchToken</code>, <code>consumeToken</code> and <code>consumeRule</code> support — no backtracking was needed in the end. Also, the performance was pretty good, and it was easier to implement the new syntax.</p>\n<p><img src=\"https://lh3.googleusercontent.com/ayty0CUxmvRE3gi842VGNuaAgiJJqeMs4INxIMPHD1p8tkXHcrcapOQ6eUhHljcW0ohXpx8RYGF9JA\" alt=\"nearley grammar diagram\"><br>\n<em>nearley grammar diagram</em></p>\n<p>To make sure I had good results, I took some other parsers: Fidus Writer’s <code>biblatex-csl-converter</code> package and the Zotero BibTeX translator. The former was easy to set up, as it was just an npm package, while the latter involved quite some tricks: installing the <a href=\"https://github.com/zotero/translation-server\">Translation Server</a> directly from GitHub, pointing an ENV variable to its config directory and running a piece of setup code, collecting all the translators I presume. Neither seemed to perform well in comparison to either my old parser, my new parser or astrocite, and I stress-tested all of them in terms of syntax:</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\">@String <span class=\"token punctuation\">{</span>maintainer <span class=\"token operator\">=</span> <span class=\"token string\">\"Xavier D\\\\'ecoret\"</span><span class=\"token punctuation\">}</span>\n\n@\n  <span class=\"token operator\">%</span>a\npreamble\n  <span class=\"token operator\">%</span>a\n<span class=\"token punctuation\">{</span> <span class=\"token string\">\"Maintained by \"</span> # maintainer <span class=\"token punctuation\">}</span>\n\n@<span class=\"token function\">String</span><span class=\"token punctuation\">(</span>stefan <span class=\"token operator\">=</span> <span class=\"token string\">\"Stefan Swe{\\\\i}g\"</span><span class=\"token punctuation\">)</span>\n@<span class=\"token function\">String</span><span class=\"token punctuation\">(</span>and <span class=\"token operator\">=</span> <span class=\"token string\">\" and \"</span><span class=\"token punctuation\">)</span>\n\n@Book<span class=\"token punctuation\">{</span>sweig42<span class=\"token punctuation\">,</span>\n  Author <span class=\"token operator\">=</span>\t stefan # and # maintainer<span class=\"token punctuation\">,</span>\n  title <span class=\"token operator\">=</span>\t <span class=\"token punctuation\">{</span> The <span class=\"token punctuation\">{</span>impossible<span class=\"token punctuation\">}</span> TEL<span class=\"token operator\">--</span><span class=\"token operator\">-</span>book <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  publisher <span class=\"token operator\">=</span>\t <span class=\"token punctuation\">{</span> D\\\\\"ead Po$_<span class=\"token punctuation\">{</span>e<span class=\"token punctuation\">}</span>$t Society<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  year <span class=\"token operator\">=</span>\t <span class=\"token number\">1942</span><span class=\"token punctuation\">,</span>\n  month <span class=\"token operator\">=</span>        mar\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>One area of expansion is all the ways BibTeX has to escape Unicode characters. Besides diacritics, which I should support completely, I think Zotero and astrocite are ahead in terms of completeness of symbols like <code>\\copyright</code>. Then again, there is <a href=\"https://www.rpi.edu/dept/arc/training/latex/LaTeX_symbols.pdf\">a great, <em>really</em> big list</a> of LaTeX symbols, and not everyone needs every symbol — nor is everything represented in Unicode. I think the best way to do this is to expose function in the configuration to expand the default supported macros, but let me know if something else comes to mind.</p>\n<p>The new parser, in its current form, has been published as part of Citation.js <code>v0.5.0-alpha.3</code>.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-6970811657431510850","title":"Debugging the Karmabug","link":"https://larsgw.blogspot.com/feeds/6970811657431510850/comments/default","published":"2019-08-16T02:12:00.002+02:00","description":"Debugging the Karmabug    For reasons I will not go through right now, I needed a new library for making synchronous HTTP requests in Node.js. I know what you are saying, “But that’s one of the seven...","isPermalink":false,"tags":["programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:26.272+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Debugging the Karmabug</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>For reasons I will not go through right now, I needed a new library for making synchronous HTTP requests in Node.js. I know what you are saying, “But that’s one of the seven deadly sins of JavaScript!” <sup>1</sup> Well, just know I had my reasons, and I wanted to replace <code>sync-request</code>.</p>\n<p>Since I was already using the Fetch API with <code>node-fetch</code> in the async part of my library, I thought: why not build a <code>sync-fetch</code>, using <code>node-fetch</code> under the hood like <code>sync-request</code> uses <code>(then-)request</code>. Two days later, it was actually working, as far as I could tell. However, if I wanted to publish this horror I need some actual testing.</p>\n<p>Luckily <code>node-fetch</code> has a nice test suite, I only needed to convert <strong>194</strong> test cases to use the synchronous API. Not fun work, but worth its while, maybe. Anyway, the first test cases worked, but then it got stuck on the first actual request.</p>\n<p>This is were I have to introduce you to the Karmabug. You see, after some testing I figured out that <em>only</em> the combination of <em>my</em> <code>sync-fetch</code> and the test server just… stopped. The arguments were correct, my <code>fetch</code> works with <code>https://example.org</code> and the test server works with <code>node-fetch</code>, but this combination simply did not. Investigating either pointed to the other, and I had no idea what to do next.</p>\n<p>That would make a good tweet, I thought. <a href=\"https://twitter.com/larswillighagen/status/1162143220039671809\">“Karma for making sync HTTP requests I guess.”</a> Literally two minutes later it hit me: that was <em>exactly</em> what was going on. The test server could not respond to the requests because the request <em>itself</em> was blocking the event loop.</p>\n<p><sup>1</sup> Incidentally, the seven deadly sins of JavaScript all happen to be Sloth.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-7305583079551006460","title":"Citation.js: RIS Rework Pt. 2","link":"https://larsgw.blogspot.com/feeds/7305583079551006460/comments/default","published":"2019-08-05T17:29:00.001+02:00","description":"Citation.js: RIS Rework Pt. 2    In the last post I explained how I started implementing the RIS specification that I found in the Internet Archive, only to discover that there is an older specification,...","isPermalink":false,"tags":["bibliography","Citation.js","programming","RIS"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:35.267+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: RIS Rework Pt. 2</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>In the <a href=\"https://larsgw.blogspot.com/2019/07/citationjs-ris-rework-pt-1.html\">last post</a> I explained how I started implementing the RIS specification that I found in the Internet Archive, only to discover that there is an older specification, which seems to be more common at times.</p>\n<p>Now, I have implemented the old spec, which luckily was not nearly as complex. One thing that came to my attention was that there were a lot of redundant tags: for title, there are <code>TI</code>, <code>T1</code>, <code>CT</code> and usually <code>BT</code>; for journal names there’s <code>JO</code> &amp; <code>JF</code>, and <code>JA</code>, <code>J1</code>, &amp; <code>J2</code> for abbreviated journal names. While I can imagine some nuanced difference in meaning between those tags, those meanings are not documented, and not trivial to figure out either. Anyway, that is not a problem for the implementation.</p>\n<p>I also updated the implementation of the new spec, to fix some mistakes and add some more mappings. In addition, because in real life there seem to be some implementations that export a mix of the two specifications, I created an implementation based on the new spec, that if needed can defer to the old one — and some random properties that Wikipedia and Zotero have picked up somewhere, and are not in either spec.</p>\n<p>How do the results look? First of all, the example that was giving me issues in the last post looks a lot nicer now:</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\"><span class=\"token punctuation\">{</span> issue<span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n  page<span class=\"token punctuation\">:</span> <span class=\"token string\">'230-265'</span><span class=\"token punctuation\">,</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token string\">'article-journal'</span><span class=\"token punctuation\">,</span>\n  volume<span class=\"token punctuation\">:</span> <span class=\"token string\">'47'</span><span class=\"token punctuation\">,</span>\n  title<span class=\"token punctuation\">:</span> <span class=\"token string\">'On computable numbers, with an application to the Entscheidungsproblem'</span><span class=\"token punctuation\">,</span>\n  author<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> family<span class=\"token punctuation\">:</span> <span class=\"token string\">'Turing'</span><span class=\"token punctuation\">,</span> given<span class=\"token punctuation\">:</span> <span class=\"token string\">'Alan Mathison'</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  issued<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'date-parts'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">[</span> <span class=\"token number\">1937</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'container-title'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Proc. of London Mathematical Society'</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>The only thing that was missing when I first tried this out was the end of the page range, because <code>SP</code> in the new spec is the entire page range, while in the old spec you need both <code>SP</code> and <code>EP</code>. I had to fix that manually — not a problem, just something to keep in mind when re-running the scripts.</p>\n<p>One other thing to check was how to the mappings look from above, without all the type-specific shenanigans. I keep <a href=\"https://docs.google.com/spreadsheets/d/13BQg5lg29VkRb4appz-eh1jcQsfI-0rdCTdmvpg577M/edit?usp=sharing\">a (public) spreadsheet</a> with mappings from CSL-JSON to all kinds of different formats, so I added the RIS mappings. So, a sanity check. Does it make sense?</p>\n<p><img src=\"https://lh3.googleusercontent.com/pLaxqMz1kLcYzrmgdrC7ebI_gDqV1kZ6fqUaoD7v162T8r8_pI_sr_UjNN7RKwOdmpiRMBjVz0e9GYQex0rF2xgjESJgDIPZqHJuY4oCTUEkvgbENGJuZyYLmyAGUhnjnTU5vEqqhW-f7KigYudnMUGg1wqbotNQE44B2TKBBwldOgXqj52fdmzKTwAvO2UTZNVUoyNbQBmFFfncdbCOiehC2Zb4sKS3c2YJ0cyHu6zhMkrgO4dFk7OGcnUWM2samSg_oRIsS01B1Y3ylzdZmLGqZfLILA1K6Yy3SMrdVZ4PLi4IJN4WVcwPkBgndErOeuFNau0XoZK54oASSuvD6hE3rI7MTsPrckhIEaNdDq5r9_QE_VsZ_pxEV-ekVdJzsGReOgh3u0oF5Y0jQsDtE-Y_OLxxqFm4Q6zrQnpsX1caZ2TZDloU-714Z0Yi0V4xl8nskweRLW52V0THrYzbvV_l_YQJV8koNl-6j55h_Lg7ocYS85-MLiunZ-mhsKBXBvQAmRix1GjOi8FkRK_kwDk0liYjen7CRHzgPGipqIewphZy3aSGOW5A9YyAcMgfPeD_HemPTPABKoKybsB45ACkfb3gSUqgsPIpO3hf4sRuRJ1N2nswlwxxxACpUiKtVH7Xq3c3U5HG-P2o0OlbUBUB92FnKoew1Gm7QT4RxT3Qg4KyHodrPMXrwnyoi550dBMNt7oIkWznrbsjlxDeompttA=w844-h469-no\" alt=\"RIS mappings\" title=\"RIS mappings\"></p>\n<p><em>No</em>, not at all! The RIS tag <code>SE</code> is mapped to 10 different CSL variables, and the CSL <code>number</code> variables is mapped to 9 different RIS tags. To me, it does not make any sense, even accounting for the fact that I know there is some variation between entry types.</p>\n<p>The question that remains is, does it work? Even if it does not look like it makes sense, the output could still make sense, if other implementations follow the specification to a similar degree. I know Zotero does not entirely follow it — all the spec anomalies that <em>are</em> implemented are attributed to weird EndNote quirks, not the weird <em>spec</em> quirks.</p>\n<p>That made me wonder to what degree the EndNote implementation follows the specification. However, I do not have EndNote, so this is a call to action! Can you help me with clearing up the RIS cloud for me by submitting your RIS exports to <a href=\"https://github.com/citation-js/ris-examples/tree/master/EndNote\">a CC0-licensed repo</a>? Preferably with all kinds of reference types — articles, books, chapters, conference papers, webpages, software, patents, bills, maps, artworks, whatever you can find. For legal reasons, please replace abstracts and other copyrightable content by <code>[... omitted]</code>.</p>\n<p>In the meantime, I will be collecting RIS exports from other sources, like Zotero and Mendeley and websites like Google Scholar, BMC and PubMed Central. If you know of any other sources, please let me know!</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-3651330421305129891","title":"Citation.js: RIS Rework Pt. 1","link":"https://larsgw.blogspot.com/feeds/3651330421305129891/comments/default","published":"2019-07-30T23:16:00.001+02:00","description":"Citation.js: RIS Rework Pt. 1    So a while ago I was looking around for the RIS specification again. I had not found it earlier, only a reference implementation from Zotero, a surprisingly complete list...","isPermalink":false,"tags":["bibliography","Citation.js","programming","RIS"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:44.284+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: RIS Rework Pt. 1</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>So a while ago I was looking around for the RIS specification again. I had not found it earlier, only a reference implementation from Zotero, a surprisingly complete list of tags and types on Wikipedia and some examples from various websites and programs exporting RIS files. They did not seem to go together well, however. There were some slight differences in tags here and there, and a bunch of useful tags listed by Wikipedia were labelled “degenerate” in the Zotero codebase, and only used for imports — implying some sort of problem.</p>\n<p>What could be going on? Well, I checked out the references on the Wikipedia page again, to see if there really was no official specification or some other more reliable source where it got its information from. And, suddenly, there <em>was</em> an actual source this time. I do not know how I missed it earlier, but there was a page (<a href=\"https://web.archive.org/web/20120526103719/http://refman.com/support/risformat_intro.asp\">archived</a>) that linked to a zip file containing a PDF file with general specifications and an Excel file with sheets with property lists for all different types.</p>\n<p>That sounded useful, so I spent <em>waaayy</em> to much time automating <a href=\"https://github.com/citation-js/ris-mappings\">a script</a> to turn those sheets — with a bunch of user input — into usable mappings for Citation.js. I just finished that today, apart from some… questionable mappings, but I wanted to at least test the final script with an example. As for the results, well, see for yourself. <a href=\"https://en.wikipedia.org/wiki/RIS_(file_format)#Example_multi-record_format\">The example</a>, from the Wikipedia page (CC-BY-SA 3.0 Unported) was</p>\n<pre><code>TY  - JOUR\nT1  - On computable numbers, with an application to the Entscheidungsproblem\nA1  - Turing, Alan Mathison\nJO  - Proc. of London Mathematical Society\nVL  - 47\nIS  - 1\nSP  - 230\nEP  - 265\nY1  - 1937\nER  -\n</code></pre>\n<p>and my results were</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\"><span class=\"token punctuation\">{</span> issue<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">:</span> <span class=\"token number\">230</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> <span class=\"token string\">'article-journal'</span><span class=\"token punctuation\">,</span> volume<span class=\"token punctuation\">:</span> <span class=\"token number\">47</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>That looked really weird and disappointing. Again, what could possibly be going on here? The example on Wikipedia is using <code>T1</code>, <code>A1</code>, <code>JO</code> and <code>Y1</code> while the specs say to use <code>TI</code>, <code>AU</code>, <code>T2</code> and <code>PY</code> here. Where are these differences coming from?</p>\n<p>After some digging around on Wikipedia I found <a href=\"https://en.wikipedia.org/wiki/Talk:RIS_(file_format)#Versions_of_the_specification\">a comment</a> saying that there are in fact two specifications: one from 2011 and one from before. The archived spec I checked out was from 2012 (as linked by Wikipedia!), while they use the version from before 2011; which luckily is <a href=\"https://web.archive.org/web/20110930172154/http://www.refman.com/support/risformat_intro.asp\">still available</a>. To be continued.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-5839944517221534662","title":"Citation.js: Usability Update","link":"https://larsgw.blogspot.com/feeds/5839944517221534662/comments/default","published":"2019-06-19T10:55:00.002+02:00","description":"Citation.js: Usability Update    Citation.js just had a bunch of tooling updated, which should make a lot of use cases easier. Let’s go through them: Replacer (GitHub, Demo) Replacer is an HTML API for...","isPermalink":false,"tags":["Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:47:55.259+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: Usability Update</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>Citation.js just had a bunch of tooling updated, which should make a lot of use cases easier. Let’s go through them:</p>\n<h3 id=\"replacer-github-demo\">Replacer (<a href=\"https://github.com/citation-js/replacer\">GitHub</a>, <a href=\"https://citation-js.github.io/replacer/\">Demo</a>)</h3>\n<p><img src=\"https://lh3.googleusercontent.com/n7PNmQCJd3Y5EVyJeoL4qwKM0rCrh8ghfk4YNBKpTpB8wG5Sm_Dgd5HzinpWJeTBeVj62eTzBQJWjg\" alt=\"Replacer demo\"></p>\n<p><strong>Replacer</strong> is an <a href=\"https://www.smashingmagazine.com/2017/02/designing-html-apis/\">HTML API</a> for Citation.js that I recently updated for the new version so that it works with components. Basic usage:</p>\n<pre class=\" language-html\"><code class=\"prism  language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n  <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation-js<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">data-input</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Wikidata ID/DOI/ISBN/GitHub repo/...<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">data-output-format</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>bibliography<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">data-output-template</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>apa<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">...</span>\n  <span class=\"token punctuation\">&gt;</span></span>\n  Fallback text for if things go wrong. This is treated\n  as input if data-input is ommitted.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>replacer.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<p>Additional features:</p>\n<ul>\n<li>Other <a href=\"https://citation.js.org/api/tutorial-output_formats.html\">output options</a> (like <code>data-output-*</code> displaye above)</li>\n<li><a href=\"https://citation.js.org/api/tutorial-input_options.html\">Input options</a>, by setting <code>data-input-*</code> on the <code>&lt;script&gt;</code> element loading <strong>Replacer</strong></li>\n<li><a href=\"https://citation.js.org/api/tutorial-plugins.html#config\">Plugin configuration</a> with <code>data-plugin-$PLUGIN-*</code> options on the <code>&lt;script&gt;</code></li>\n</ul>\n<p>To get a <code>replacer.js</code> with the tools you want, use the <strong>Bundle tool</strong>:</p>\n<h3 id=\"bundle-tool-github-demo\">Bundle Tool (<a href=\"https://github.com/citation-js/bundle-tool\">GitHub</a>, <a href=\"https://juniper-coat.glitch.me\">Demo</a>)</h3>\n<p><img src=\"https://lh3.googleusercontent.com/7bzrh4FMzxjn7P9ydoR61tMNlq7K2apVQphkBeRYgMyOIg2JXuhCBGiyaoLuO2BYBIdcJQEYPo5AVQ=s400\" alt=\"Bundle tool screenshot\" title=\"Bundle tool screenshot\"></p>\n<p>The <strong>Bundle tool</strong> is a small website where you can compose a bundle of Citation.js components, choosing exactly what you need. You can pick the plugins you want, choose to add <strong>Replacer</strong> functionality or leave the core out altogether to split some files.</p>\n<p>After clicking <kbd>Create Bundle</kbd> you are redirected to a page where you can download your live-created bundle. Please do not include that script on your page; there is no caching so every time you load your page it would have to re-run Browserify and that could be a bit problematic for other users and for <a href=\"\">Glitch</a>, where it is hosted.</p>\n<p>To still be available in such cases, and because I have to manually update component versions and I might not have done that yet at that moment, you can host it yourself to. The code is on GitHub, and <code>npm install &amp;&amp; npm start</code> should work perfectly fine. Alternatively, you can remix <a href=\"https://glitch.com/edit/#!/juniper-coat\">the project</a> on <a href=\"https://glitch.com/\">Glitch</a>, which is probably <a href=\"https://glitch.com/about/features/#startbyremixing\">a lot easier</a> (just one click).</p>\n<h3 id=\"cli-github\">CLI (<a href=\"https://github.com/citation-js/citation-js/tree/master/packages/cli#readme\">GitHub</a>)</h3>\n<p>The <strong>CLI</strong> is also updated to include some of the new options. Specifically, with some tricks special output options are now supported, as well as input options and plugin configuration. For example:</p>\n<pre class=\" language-bash\"><code class=\"prism  language-bash\"><span class=\"token comment\"># Prefer Japanese when picking Wikidata labels</span>\ncitation-js --plugin-config <span class=\"token string\">\"@wikidata.langs=[ja,en]\"</span>\n\n<span class=\"token comment\"># Force the parser to assume it is a generic URL (and not a</span>\n<span class=\"token comment\"># specific one)</span>\ncitation-js --input-force-type <span class=\"token string\">\"@else/url\"</span>\n\n<span class=\"token comment\"># Load the ISBN plugin (not included by default)</span>\n<span class=\"token comment\"># Note: this still loads the plugins that are included by default</span>\ncitation-js --plugins isbn\n\n<span class=\"token comment\"># Do not sort the bibliography with the algorithm specified by the</span>\n<span class=\"token comment\"># style/template, but rather keep the original (input) order.</span>\n<span class=\"token comment\"># Note: you still need \"-s citation-apa\" et cetera</span>\ncitation-js --formatter-opts <span class=\"token string\">\"nosort=false\"</span>\n</code></pre>\n<hr>\n<p>So, hopefully that improves the ways people use Citation.js. As always, feedback is welcome on the various GitHub repos or on <a href=\"https://gitter.im/citation-js/Lobby\">Gitter</a>.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-3341787060909416565","title":"Citation.js: Wikidata Update","link":"https://larsgw.blogspot.com/feeds/3341787060909416565/comments/default","published":"2019-05-25T15:19:00.002+02:00","description":"Citation.js: Wikidata Update    The new update, v0.4.4, contains a few Wikidata improvements (commit): 22 new mappings 2 fixed mappings (ISSN did not work and publisher-place was mapped to the wrong...","isPermalink":false,"tags":["bibliography","Citation.js","programming","Wikidata"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:03.908+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: Wikidata Update</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>The new update, <code>v0.4.4</code>, contains a few <a href=\"https://wikidata.org\">Wikidata</a> improvements (<a href=\"%5Bhttps://github.com/citation-js/citation-js/commit/01be9362a9106b886fc6d8f37d8a4d53ecc49d22%5D(https://github.com/citation-js/citation-js/commit/01be9362a9106b886fc6d8f37d8a4d53ecc49d22)\">commit</a>):</p>\n<ul>\n<li>22 new mappings</li>\n<li>2 fixed mappings (<code>ISSN</code> did not work and <code>publisher-place</code> was mapped to the wrong thing)</li>\n<li>2 improved mappings (<code>container-title</code> for chapters and more <code>URL</code> mappings)</li>\n<li>1 removed mapping (<code>genre</code> was inconsistent with the <a href=\"%5Bhttps://discourse.citationstyles.org/t/inconsistencies-with-genre-and-medium/1475%5D(https://discourse.citationstyles.org/t/inconsistencies-with-genre-and-medium/1475)\">intended use</a>, although it followed the specification)</li>\n</ul>\n<p>Because most of these mappings require additional resources (<code>recipient</code> has to fetch people, <code>review-*</code> has to fetch the review subject and <code>original-publisher-place</code> has to fetch the country and location of the publisher of the original version of a work) this would have caused a lot more requests to the API. It is a good thing, then, that there is a new resolver in place, which pre-fetches such information for all requested works at once.</p>\n<p>This has to be done in levels; you cannot fetch the country if you do not have the location, the location requires the publisher and to find out the publisher you have to have the work already. However, temporarily ignoring the cap of 50 items per request, the number of requests is now only based on those levels (which is at most five), instead of the number of claims requiring additional requests.</p>\n<p>For example, item <a href=\"https://www.wikidata.org/wiki/Q21972834\"><code>Q21972834</code></a> (<em>Assembling the 20 Gb white spruce (Picea glauca) genome from whole-genome shotgun sequencing data</em>) takes:</p>\n<ul>\n<li><strong>6 requests</strong> in <code>v0.4.0-rc.2</code>, before requests for properties were grouped (so it would make a request for every author)</li>\n<li><strong>3 requests</strong> in <code>v0.4.3</code>: one for the work, one for the authors, and one for journal</li>\n<li><strong>2 requests</strong> in <code>v0.4.4</code>, which includes a bunch of new mappings that would have cost a total of 5 requests in the previous version</li>\n</ul>\n<p>Grouping the requests from all works has the added benefit of not having to fetch the same author and journal info repeatedly — which can be quite common for bibliographies. For example, the bibliography of <a href=\"https://egonw.github.io/cdkbook\"><em>Groovy Cheminformatics with the Chemistry Development Kit</em></a>, currently containing 74 items, takes 11 requests in the new version. For the same bibliography, the previous version would make at least 150 requests — for each item one for all the authors and one for the journal — and probably more than that.</p>\n<pre><code>[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q24599948%7CQ24650571%7CQ25713029%7CQ27061829%7CQ27062363%7CQ27062596%7CQ27065423%7CQ27093381%7CQ27134682%7CQ27134746%7CQ27134827%7CQ27162658%7CQ27211680%7CQ27499209%7CQ27656255%7CQ27783585%7CQ27783587%7CQ27902272%7CQ28090714%7CQ28133283%7CQ28186592%7CQ28837846%7CQ28837922%7CQ28837925%7CQ28837939%7CQ28837943%7CQ28837947%7CQ28842810%7CQ28842968%7CQ28843132%7CQ29039683%7CQ29042322%7CQ29616639%7CQ30149558%7CQ30853915%7CQ31127242%7CQ33874102%7CQ34160151%7CQ34206190%7CQ36662828%7CQ37988904%7CQ39811432%7CQ42704791%7CQ47543807%7CQ47632144%7CQ54062338%7CQ55880270%7CQ55934414%7CQ55954394%7CQ56112883&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q56170978%7CQ56454405%7CQ57836257%7CQ59771351%7CQ60167226%7CQ60167327%7CQ60167615%7CQ60167690%7CQ61463648%7CQ61649587%7CQ61779181%7CQ61779373%7CQ61779901%7CQ61779905%7CQ61779940%7CQ61780124%7CQ62926016%7CQ62926155%7CQ62927888%7CQ62968825%7CQ62969352%7CQ62969354%7CQ63367539%7CQ63367548&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q135122%7CQ1223539%7CQ59196164%7CQ1860%7CQ8513%7CQ766195%7CQ7441%7CQ28946414%7CQ50332566%7CQ46330054%7CQ57218960%7CQ57218835%7CQ55965812%7CQ43370919%7CQ37391332%7CQ57677801%7CQ60446154%7CQ60447576%7CQ60449513%7CQ29946263%7CQ60465926%7CQ60890297%7CQ20895241%7CQ910067%7CQ3007982%7CQ52113739%7CQ5111731%7CQ29405902%7CQ47473872%7CQ121182%7CQ128570%7CQ910164%7CQ2383032%7CQ1130645%7CQ908710%7CQ5727848%7CQ27065426%7CQ28946652%7CQ42783959%7CQ4420286%7CQ749647%7CQ309823%7CQ28540892%7CQ29052381%7CQ29052386%7CQ4914910%7CQ12149006%7CQ853614%7CQ1418791%7CQ50731867&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q56007851%7CQ5195068%7CQ11351%7CQ75%7CQ151332%7CQ3002926%7CQ27061944%7CQ27134800%7CQ6294930%7CQ27061853%7CQ28540435%7CQ28854723%7CQ766383%7CQ1425625%7CQ28540616%7CQ55406442%7CQ483666%7CQ11173%7CQ39972290%7CQ1069211%7CQ36534%7CQ27211732%7CQ251%7CQ1768406%7CQ1689854%7CQ30046697%7CQ55406542%7CQ5227350%7CQ38372872%7CQ38373802%7CQ3841253%7CQ55213915%7CQ7440973%7CQ30045595%7CQ451553%7CQ466769%7CQ203250%7CQ54837%7CQ3355939%7CQ40023319%7CQ26842658%7CQ109081%7CQ82264%7CQ898902%7CQ27711423%7CQ1767639%7CQ7209103%7CQ27768873%7CQ900316%7CQ48803&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q1884753%7CQ15064016%7CQ895901%7CQ2166958%7CQ907701%7CQ309%7CQ28796322%7CQ19845641%7CQ27061849%7CQ28923506%7CQ30046701%7CQ28865170%7CQ43370334%7CQ29387575%7CQ50983316%7CQ7395247%7CQ192864%7CQ336658%7CQ58409692%7CQ56421913%7CQ55182163%7CQ55182165%7CQ56670283%7CQ925779%7CQ50731930%7CQ909510%7CQ381009%7CQ38173%7CQ30046335%7CQ43370883%7CQ3705921%7CQ1154615%7CQ2334061%7CQ1988917%7CQ898967%7CQ2425378%7CQ10354104%7CQ47  480%7CQ1709878%7CQ900502&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q1120519%7CQ1860%7CQ113337%7CQ1767639%7CQ27134800%7CQ6294930%7CQ251%7CQ5776092%7CQ56421877%7CQ463360%7CQ109081%7CQ50731930%7CQ176916%7CQ26707540%7CQ30046697%7CQ28925563%7CQ1122491%7CQ3186908%7CQ969707%7CQ1948400%7CQ192864%7CQ898902%7CQ2835897%7CQ3007982%7CQ46155617%7CQ905549%7CQ485223%7CQ900502%7CQ15766522&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q7050%7CQ32%7CQ64%7CQ225471&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q47501431&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q33467704&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q55&amp;format=json&amp;languages=en {}  \n[core] GET https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q183%7CQ145&amp;format=json&amp;languages=en {}  \n</code></pre>\n<p>However, I <em>do</em> notice slightly more requests with a low number of items than I would expect. I will look into that.</p>\n<h3 id=\"conference-papers-in-wikidata\">Conference papers in Wikidata</h3>\n<p>Part of the mappings that were added in the recent update are the <code>event-*</code> properties, i.e. “name of the related event (e.g. the conference name when citing a conference paper)” (<a href=\"https://docs.citationstyles.org/en/master/specification.html#appendix-iv-variables\">spec</a>). Finding out how those are modelled in Wikidata proved a bit of a challenge, as most instances of <a href=\"https://www.wikidata.org/wiki/Q23927052\"><code>Q23927052</code> (conference paper)</a> are published in proceedings with the <code>book</code> type. To get some numbers (<a href=\"https://w.wiki/4JL\">query</a>):</p>\n\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>typeLabel</th>\n<th>items</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q571\">Q571</a></td>\n<td>book</td>\n<td>715</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q5633421\">Q5633421</a></td>\n<td>scientific journal</td>\n<td>676</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q1143604\">Q1143604</a></td>\n<td>proceedings</td>\n<td>315</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q16024164\">Q16024164</a></td>\n<td>medical journal</td>\n<td>53</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q23927052\">Q23927052</a></td>\n<td>conference paper</td>\n<td>48</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q1002697\">Q1002697</a></td>\n<td>periodical literature</td>\n<td>32</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q41298\">Q41298</a></td>\n<td>magazine</td>\n<td>29</td>\n</tr>\n<tr>\n<td>other</td>\n<td>other</td>\n<td>61</td>\n</tr>\n</tbody>\n</table><p>48 conference papers are published in conference papers? That does not seem right. But maybe they just have the wrong type, but still link to the event? Well no, not really (<a href=\"https://w.wiki/4JN\">query</a>).</p>\n\n<table>\n<thead>\n<tr>\n<th>hasEvent</th>\n<th>items</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>false</td>\n<td>1952</td>\n</tr>\n<tr>\n<td>true</td>\n<td>6</td>\n</tr>\n</tbody>\n</table><p>Luckily, the information is not lost: usually, the label contains location and date information about the event, although extracting that would be probably be a tedious task. However, perhaps there are a lot of proper proceedings out there, but the articles linked to it just have the wrong type (<a href=\"https://w.wiki/4JH\">query</a>)?</p>\n\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>typeLabel</th>\n<th>items</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q13442814\">Q13442814</a></td>\n<td>scholarly article</td>\n<td>3513</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q23927052\">Q23927052</a></td>\n<td>conference paper</td>\n<td>315</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q3331189\">Q3331189</a></td>\n<td>version, edition, or translation</td>\n<td>11</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q1143604\">Q1143604</a></td>\n<td>proceedings</td>\n<td>9</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q10885494\">Q10885494</a></td>\n<td>scientific conference paper</td>\n<td>7</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q1980247\">Q1980247</a></td>\n<td>chapter</td>\n<td>6</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q191067\">Q191067</a></td>\n<td>article</td>\n<td>5</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q18918145\">Q18918145</a></td>\n<td>academic journal article</td>\n<td>4</td>\n</tr>\n<tr>\n<td><a href=\"http://www.wikidata.org/entity/Q333291\">Q333291</a></td>\n<td>abstract</td>\n<td>3</td>\n</tr>\n<tr>\n<td>other</td>\n<td>other</td>\n<td>10</td>\n</tr>\n</tbody>\n</table><p>That seems to be the case: most works that are published in instances of proceedings are tagged as instances of scholarly articles, and only nine are tagged as both. And: relatively many have events linked to them (<a href=\"https://w.wiki/4JP\">query</a>).</p>\n\n<table>\n<thead>\n<tr>\n<th>hasEvent</th>\n<th>items</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>true</td>\n<td>2692</td>\n</tr>\n<tr>\n<td>false</td>\n<td>1184</td>\n</tr>\n</tbody>\n</table><p>That’s better. I’ll look into working together with WikiCite to work on the rest.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-5069831478081350576","title":"Citation.js Version 0.4: The Catch-up","link":"https://larsgw.blogspot.com/feeds/5069831478081350576/comments/default","published":"2019-04-11T22:24:00.002+02:00","description":"Citation.js Version 0.4: The Catch-up    After about two years, finally v0.4.0 is ready for a release. Whether it is a real milestone given that there have been prereleases for about two years, while...","isPermalink":false,"tags":["bibliography","Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:18.134+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js Version 0.4: The Catch-up</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>After about two years, finally <code>v0.4.0</code> is ready for a release. Whether it is a real milestone given that there have been prereleases for about two years, while <code>0.3.x</code> only lasted three weeks, is for you to decide but I am glad that everything I planned for this version is implemented now.</p>\n<p><img src=\"https://citation.js.org/static/img/square_logo.png\" alt=\"Citation.js logo\" width=\"300\"></p>\n<h3 id=\"changes\">Changes</h3>\n<p>So, let’s go through the major changes.</p>\n<h4 id=\"modules\">Modules</h4>\n<p>Most importantly, the code is fully modulated now. The different components, the core, the CLI and all the individual format plugins, are <a href=\"https://www.npmjs.com/org/citation-js\">available on their own now</a>. The <code>citation-js</code> is now designed as a shell around those components, maintaining full backwards compatibility (apart from mapping changes) until that is no longer required.</p>\n<h4 id=\"mappings\">Mappings</h4>\n<p>A lot of different formats where either improved or introduced. The main newcomer is RIS, still only as output format. Support for NDJSON output was also added. The handling of styling and case-preserving brackets in BibTeX fields was improved, although the method of parsing those files is still lagging behind.</p>\n<p>Thanks to (independent) practical testing by Egon Willighagen and Jakob Voss and the <a href=\"https://github.com/maxlath/wikidata-sdk/commits?author=maxlath\"><code>wikidata-sdk</code></a> library by Maxime Lathuilière we were also able to improve the Wikidata mapping quite a lot, although there is still work ahead.</p>\n<h4 id=\"configuration\">Configuration</h4>\n<p>Apart from the potential for customization that comes with the separate modules, there is quite some new configuration available. First of all, input parsing has some options: <code>strict</code> which basically switches between errors and failing silently (not-so-long ago the default behavior); and <code>target</code> which allows the user to specify a certain point at which the parsing should be stopped, mainly useful for debugging.</p>\n<p>Furthermore, individual input formats can be configured now too. For example, the default languages used in the Wikidata plugin can be configured now. The methods to add CSL templates and locales which was already available is using the same mechanism now.</p>\n<p>Finally, CSL output with <code>citeproc-js</code> has been amended. First and foremost, support for <code>citation</code> has been added (or rather, the original <code>citation-*</code> has been renamed to <code>bibliography</code>), so it is possible to get actual citations now. Also, the <code>nosort</code> option has been added and the <code>prepend</code>/<code>append</code> options been improved.</p>\n<h4 id=\"stability--best-practices\">Stability &amp; best practices</h4>\n<p>Also important, there’s a lot more testing now and the commit messages and code style follow standard guidelines. Making a new repository for the different modules actually helped with that, allowing me to re-evaluate the decisions I made in that aspect.</p>\n<p><a href=\"https://github.com/larsgw/citation.js/blob/master/CHANGELOG.md\">The full changelog is available here.</a></p>\n<h3 id=\"paper--preprint\">Paper &amp; Preprint</h3>\n<p>In the middle of all that (literally, the development halted for a few months) I wrote a paper about Citation.js, which I am currently revising after review. <a href=\"https://peerj.com/preprints/27466/?td=bl\">The preprint is available here.</a></p>\n<h3 id=\"further-development\">Further development</h3>\n<p>There’s still a lot to be done, most of which has been discussed in the “Discussion” section of the preprint. I’ll go into some things that are planned for the (relatively) near future, other than additional mappings of course.</p>\n<h4 id=\"another-wikidata-refactor\">(Another) Wikidata refactor</h4>\n<p>Part of the recent development to finish the release was a refactoring of the Wikidata parsing code to facilitate some changes and mainly to reduce unnecessary code duplication, originally the result of sync/async variants of almost every function. However, while working on that I came up with an even better refactor which should minimize the problems of under-fetching that I described in the preprint.</p>\n<p>To recap, under-fetching is the problem of not being able to fetch enough information in the desired amount of HTTP requests. For example, in Wikidata it’s not possible to get item labels of property values such as <a href=\"https://www.wikidata.org/wiki/Property:P50\"><code>P50</code> (author)</a>, and they require another HTTP call. It is not possible to fetch them together with the publication item you are fetching since you do not know who the authors are yet.</p>\n<p>So the minimal number of requests (not taking the limit of 50 items per request) is one for each “level” you need to go down: author labels would be the second level, and fetching the labels of name items if you decide to use <a href=\"https://www.wikidata.org/wiki/Property:P735\"><code>P735</code> (given name)</a> and <a href=\"https://www.wikidata.org/wiki/Property:P734\"><code>P734</code> (family name)</a> would be the third. That’s what this refactor will try to accomplish, and it shouldn’t be too complex but still non-trivial.</p>\n<h4 id=\"turning-the-chain-parser-into-a-tree-parser\">Turning the chain parser into a tree parser</h4>\n<p>Currently the input is parsed iteratively, in a “chain” of types. For example, a Wikidata ID becomes a Wikidata API URL, which returns JSON, which gets parsed, and the resulting API response gets transformed into CSL-JSON. This also ensures that people could input a Wikidata API URL if they want, and that fetching and parsing JSON from a web resource doesn’t have to be implemented over and over again.</p>\n<p>When encountering arrays, if they are not recognized as some special array, each element is parsed until the target (CSL-JSON) is reached, at which point it returns. However, this proved problematic with some new features, like the <code>target</code> option (parse until this format is reached, instead of the default CSL-JSON). Firstly, such options cannot be passed down to the other parsing functions, and secondly if a certain target format is reached in the array elements then the total format is always going to be an array of that, and will never match the target.</p>\n<p>A refactor of the parser, branching it instead of whatever is going on currently, should counter this.</p>\n<h4 id=\"more-citeproc-interactions\">More <code>citeproc</code> interactions</h4>\n<p><code>citeproc</code> is currently used in an almost state-less manner, which works fine for bibliographies but is quite limiting for working with citations. While users could redirect CSL output to <code>citeproc</code> themselves, why not do it for them with more bibliography management, which Citation.js mostly lacks at the moment.</p>\n<h4 id=\"ditching-csl-json-as-the-central-format\">Ditching CSL-JSON as the central format?</h4>\n<p>CSL-JSON is great, but also quite limiting considering the available properties, the general problems of which are also discussed in the preprint. While additions could be made to CSL in terms of variables, which Frank Bennet has already done with CSL-M, and which the CSL team is doing now with a new release finally specifying a computer program type, CSL remains intended for generating citations, not for storing bibliographical data. At least, according to a quote that I cannot find anymore.</p>\n<p>However, this becomes quite clear practically. I count 10 of the 78 fields being specific to citing the item. An additional 4 are (usually) redundant and 3 poorly defined, one with just a question mark as description. On top of that, 12 could be replaced by allowing references to other publications, which would require just 4 fields instead, and 4 that could be replaced by other entities such as venues requiring no additional properties.</p>\n<p>Still, moving to a different format is quite something and this will have to be discussed. Of course, support for CSL-JSON wouldn’t be removed either way, just not exclusively used for storage. Also, these changes would take place way after any pending changes.</p>\n<hr>\n<p>And that is it for this post. Any feedback on the release and ideas for the things discussed above is very welcome here, in <a href=\"https://github.com/citation-js/citation-js\">the GitHub repo</a> or on Twitter (<a href=\"https://twitter.com/larswillighagen\">@larswillighagen</a>).</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-3881296511536301842","title":"Citation.js: Wikidata Subclasses","link":"https://larsgw.blogspot.com/feeds/3881296511536301842/comments/default","published":"2019-01-03T14:54:00.002+01:00","description":"Citation.js: Wikidata Subclasses    I am in the process of creating a better way to map CSL types to Wikidata types together with Jakob Voß, and while listing all subtypes of web page, I came across a...","isPermalink":false,"tags":["bibliography","Citation.js","programming","Wikidata"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:24.883+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: Wikidata Subclasses</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>I am <a href=\"https://github.com/larsgw/citation.js/issues/166\">in the process</a> of creating a better way to map CSL types to Wikidata types together with <a href=\"https://github.com/nichtich\">Jakob Voß</a>, and while listing all subtypes of <code>web page</code>, I came across a number of these cases (<a href=\"%5Bhttp://tinyurl.com/y9pfhbg4%5D(http://tinyurl.com/y9pfhbg4)\">link</a>):</p>\n<pre class=\" language-sql\"><code class=\"prism  language-sql\"><span class=\"token comment\">#defaultView:Graph</span>\n<span class=\"token keyword\">SELECT</span> ?<span class=\"token number\">a</span> ?aLabel ?<span class=\"token number\">b</span> ?bLabel <span class=\"token keyword\">WHERE</span> {\n  wd:Q58803899 wdt:P279<span class=\"token operator\">*</span> ?<span class=\"token number\">a</span> <span class=\"token punctuation\">.</span>\n  ?<span class=\"token number\">a</span> wdt:P279 ?<span class=\"token number\">b</span> <span class=\"token punctuation\">.</span>\n  FILTER <span class=\"token keyword\">EXISTS</span> {\n    ?<span class=\"token number\">b</span> wdt:P279<span class=\"token operator\">*</span> wd:Q386724 <span class=\"token punctuation\">.</span>\n  }\n  SERVICE wikibase:label { <span class=\"token number\">bd</span>:serviceParam wikibase:language <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">.</span> }\n}\n</code></pre>\n<p><img src=\"https://lh3.googleusercontent.com/O0BEo-lUhm0Decr9ByvVtmk0hxS9sOblL2awKtVI6NYx28DFYbm-G2xsTEGVR3m4bZdMcZyglTYeNA\" alt=\"\" title=\"Query results\"></p>\n<p>I’m no expert on Wikidata data models, nor on the semantics of each of those items in specific, but I’m pretty sure <a href=\"https://www.wikidata.org/wiki/Q58803899\">Count of Barcelos (Q58803899)</a> is not a subclass of <a href=\"https://www.wikidata.org/wiki/Q36774\">web page (Q36774)</a>. However, the individual parts seem pretty reasonable, so where does it go wrong then?</p>\n<p>Luckily, the description of <a href=\"https://www.wikidata.org/wiki/Property:P279\">subclass of (P279)</a> provides some good guidance:</p>\n<blockquote>\n<p>all instances of these items are instances of those items; this item is a class (subset) of that item.</p>\n</blockquote>\n<p>So let’s check those:</p>\n<ol>\n<li>All counts of Barcelos <strong>are</strong> Portuguese counts (<code>conde</code>), as Barcelos lies in Portugal</li>\n<li>All condes <strong>are</strong> counts</li>\n<li>Counts <strong>are not</strong> hereditary titles themselves, so I think this should be a <a href=\"https://www.wikidata.org/wiki/Property:P31\">instance of (P31)</a>. Also, counts are indirectly subclass of <code>royal or noble rank</code> through <code>hereditary title</code>s, but directly instance of <code>royal or noble rank</code>.</li>\n<li>Hereditary titles do not seem like an exact subclass of royal or noble ranks to me, but it passes the basic test</li>\n<li>I am unsure about royal or noble rank as subclass of rank, since the latter seems way more abstract, but perhaps that’s the point</li>\n<li>(rank -&gt; first-order metaclass) I have no idea what the intention with these metaclasses is, so I’m going to assume this is all correct (bold move)</li>\n<li>first-order metaclass -&gt; fixed-order metaclass</li>\n<li>fixed-order metaclass -&gt; Wikidata metaclass: “class of classes, class whose instances are classes”</li>\n<li>Wikidata metaclass -&gt; class or metaclass of Wikidata ontology (should maybe be P31 as well, still no clue though)</li>\n<li>class or metaclass of Wikidata ontology -&gt; Wikidata item: finally back into some form of concrete-ness. Problem being, not all instances of <code>royal or noble rank</code>s are <code>Wikidata item</code>s, so something went wrong somewhere in between, maybe even at (6).</li>\n<li>Wikidata item -&gt; Wikidata internal entity</li>\n<li>Wikidata internal entity -&gt; Wikidata internal item</li>\n<li>Wikidata internal item -&gt; MediaWiki page</li>\n<li>MediaWiki page -&gt; web page: actually pretty reasonable, instances of <code>Wikidata item</code>s <strong>are</strong> <code>web page</code>s.</li>\n</ol>\n<p>There are a little less than 900 instances of <code>web page</code> so the impact is smaller than I had expected, but it’s still annoying. There are 191 subclasses of <code>conde</code>, not to mention the total of 280 royal or noble ranks that have no business being a subclass of <code>web page</code>.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-2892482322477332695","title":"Citation.js: Showing Blogger Posts on a Different Site","link":"https://larsgw.blogspot.com/feeds/2892482322477332695/comments/default","published":"2018-08-22T21:36:00.001+02:00","description":"Citation.js: Showing Blogger Posts on a Different Site    I made a small client for Blogger that takes a tag and transforms it into its own little blog: citation.js.org/blog/?post=542…. No metadata...","isPermalink":false,"tags":["Citation.js","programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:33.511+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: Showing Blogger Posts on a Different Site</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><blockquote>\n<p>I made a small client for Blogger that takes a tag and transforms it into its own little blog: <a href=\"https://t.co/CYoveVJIOE\">citation.js.org/blog/?post=542…</a>. No metadata though, as it’s all client-side.<br>\n— Lars Willighagen (@larswillighagen)  <a href=\"https://twitter.com/larswillighagen/status/1026536137958072320?ref_src=twsrc%5Etfw\">August 6, 2018</a></p>\n</blockquote>\n<p>I made a <a href=\"https://getmdl.io\">Material-themed</a> page showing Citation.js blog posts from Blogger. It supports pagination, tags, search and linking individual posts. Since it’s a single, static page I can’t support <code>meta</code> and <code>link</code> tags for metadata, that would require JavaScript which indexers don’t run.</p>\n<p>The great thing about the Blogger API is that you can generate feeds for single tags, like Citation.js for example, and search for tags and general queries within that tag. That’s what makes all this possible. The URL scheme is very simple:</p>\n<pre class=\" language-bash\"><code class=\"prism  language-bash\"><span class=\"token comment\"># Tag feed</span>\nhttps://<span class=\"token variable\">$BLOG</span>.blogspot.com/feeds/posts/default/-/<span class=\"token variable\">$TAG</span>\n\n<span class=\"token comment\"># Tag-in-tag feed</span>\nhttps://<span class=\"token variable\">$BLOG</span>.blogspot.com/feeds/posts/default/-/<span class=\"token variable\">$TAG</span>/<span class=\"token variable\">$OTHER_TAG</span>\n\n<span class=\"token comment\"># Search-in-tag feed</span>\n<span class=\"token comment\"># Note: don't copy this, there's a ZWS before ?q= for syntax highlighting</span>\nhttps://<span class=\"token variable\">$BLOG</span>.blogspot.com/feeds/posts/default/-/<span class=\"token variable\">$TAG</span>​?q<span class=\"token operator\">=</span><span class=\"token variable\">$QUERY</span>\n\n<span class=\"token comment\"># Post</span>\nhttps://<span class=\"token variable\">$BLOG</span>.blogspot.com/feeds/posts/default/<span class=\"token variable\">$POST</span>\n</code></pre>\n<p>Pagination and response formats complicate things a little, and are dealt with in the code below.</p>\n<p>Apart from the Material theme, it only uses vanilla JavaScript to generate the pages. The search bar doesn’t even use JavaScript at all, just good ol’ <code>form</code> semantics. The JavaScript it does use is fairly simple. First, the query is parsed and an API URL is generated.</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  location<span class=\"token punctuation\">.</span>search<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&amp;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>pair<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    pair <span class=\"token operator\">=</span> pair<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'='</span><span class=\"token punctuation\">)</span>\n    params<span class=\"token punctuation\">[</span>pair<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pair<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">var</span> url\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://larsgw.blogspot.com/feeds/posts/default/'</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">.</span>post <span class=\"token operator\">+</span> <span class=\"token string\">'?alt=json-in-script&amp;callback=cb'</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://larsgw.blogspot.com/feeds/posts/default/-/Citation.js/'</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">.</span>tag <span class=\"token operator\">+</span> <span class=\"token string\">'?alt=json-in-script&amp;callback=cb'</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://larsgw.blogspot.com/feeds/posts/default/-/Citation.js/?q='</span> <span class=\"token operator\">+</span> params<span class=\"token punctuation\">.</span>query <span class=\"token operator\">+</span> <span class=\"token string\">'&amp;alt=json-in-script&amp;callback=cb'</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://larsgw.blogspot.com/feeds/posts/default/-/Citation.js?alt=json-in-script&amp;callback=cb'</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> startIndex <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/start-index=(\\d+)/</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>startIndex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">+=</span> <span class=\"token string\">'&amp;'</span> <span class=\"token operator\">+</span> startIndex<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">load</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>Since the only JSON API for Blogger is JSON-in-script, we append a script element loading the resource. This then calls the callback, <code>cb</code>.</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">cb</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  content<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>feed <span class=\"token operator\">?</span> templates<span class=\"token punctuation\">.</span><span class=\"token function\">feed</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>feed<span class=\"token punctuation\">.</span>entry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> templates<span class=\"token punctuation\">.</span><span class=\"token function\">feedItem</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>entry<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// pagination</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>feed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> href <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>href\n    <span class=\"token keyword\">var</span> hasIndex <span class=\"token operator\">=</span> href<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'start-index'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">var</span> hasParams <span class=\"token operator\">=</span> href<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'?'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n    <span class=\"token keyword\">var</span> indexPattern <span class=\"token operator\">=</span> <span class=\"token regex\">/start-index=(\\d+)/</span>\n\n    <span class=\"token keyword\">var</span> prev <span class=\"token operator\">=</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>feed<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> link<span class=\"token punctuation\">.</span>rel <span class=\"token operator\">===</span> <span class=\"token string\">'previous'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      prev <span class=\"token operator\">=</span> <span class=\"token string\">'start-index='</span> <span class=\"token operator\">+</span> prev<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>indexPattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> hasIndex <span class=\"token operator\">?</span> href<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>indexPattern<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> href <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>hasParams <span class=\"token operator\">?</span> <span class=\"token string\">'?'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> prev\n      paginatePrev<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'href'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">var</span> next <span class=\"token operator\">=</span> <span class=\"token function\">find</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>feed<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> link<span class=\"token punctuation\">.</span>rel <span class=\"token operator\">===</span> <span class=\"token string\">'next'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      next <span class=\"token operator\">=</span> <span class=\"token string\">'start-index='</span> <span class=\"token operator\">+</span> next<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>indexPattern<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> hasIndex <span class=\"token operator\">?</span> href<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>indexPattern<span class=\"token punctuation\">,</span> next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> href <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>hasParams <span class=\"token operator\">?</span> <span class=\"token string\">'&amp;'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'?'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> next\n      paginateNext<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'href'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">load</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  loader<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>The callback then uses simple templates, which are just JS functions taking in the API response and outputting HTML to show the results on the page. Then, it figures out the pagination. Below is an example template.  It extracts the post id to make links and does some preprocessing, removing stackedit metadata and styling and lowering each heading two levels. Then, it puts together the HTML with some additional util functions and subtemplates.</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\">  feedItem<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> id <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>$t<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/^.*\\.post-(\\d+)$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$1'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">var</span> content <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>$t\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/^[\\s\\S]*&lt;div class=\"stackedit__html\"&gt;([\\s\\S]*)&lt;\\/div&gt;[\\s\\S]*$/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$1'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/&lt;(\\/?)h([1-6])/g</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">,</span> slash<span class=\"token punctuation\">,</span> level<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>level <span class=\"token operator\">&gt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token string\">'&lt;'</span> <span class=\"token operator\">+</span> slash <span class=\"token operator\">+</span> <span class=\"token string\">'b'</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token string\">'&lt;'</span> <span class=\"token operator\">+</span> slash <span class=\"token operator\">+</span> <span class=\"token string\">'h'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">+</span>level <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'&lt;div class=\"mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col\"&gt;'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;div class=\"mdl-card__title\"&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;h2 class=\"mdl-card__title-text\"&gt;'</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;a href=\"?post='</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span> <span class=\"token string\">'\"&gt;'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">.</span>$t <span class=\"token operator\">+</span> <span class=\"token string\">'&lt;/a&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;/h2&gt;'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;/div&gt;'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;div class=\"mdl-card__supporting-text mdl-card--border\"&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;p&gt;'</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;span&gt;&lt;i class=\"material-icons\"&gt;edit&lt;/i&gt; '</span> <span class=\"token operator\">+</span>\n            templates<span class=\"token punctuation\">.</span><span class=\"token function\">author</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;/span&gt;'</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;span&gt;&lt;i class=\"material-icons\"&gt;access_time&lt;/i&gt; '</span> <span class=\"token operator\">+</span>\n            <span class=\"token function\">formatDate</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>updated<span class=\"token punctuation\">.</span>$t<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;/span&gt;'</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;span&gt;&lt;i class=\"material-icons\"&gt;link&lt;/i&gt; &lt;a href=\"'</span> <span class=\"token operator\">+</span>\n            <span class=\"token function\">canonical</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>link<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'\"&gt;Original post&lt;/a&gt;&lt;/span&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;/p&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;p&gt;'</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;span&gt;&lt;i class=\"material-icons\"&gt;bookmark&lt;/i&gt; '</span> <span class=\"token operator\">+</span>\n            <span class=\"token function\">map</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>category<span class=\"token punctuation\">,</span> templates<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n          <span class=\"token string\">'&lt;/span&gt;'</span> <span class=\"token operator\">+</span>\n        <span class=\"token string\">'&lt;/p&gt;'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;/div&gt;'</span> <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;div class=\"mdl-card__supporting-text\"&gt;'</span> <span class=\"token operator\">+</span>\n        content <span class=\"token operator\">+</span>\n      <span class=\"token string\">'&lt;/div&gt;'</span> <span class=\"token operator\">+</span>\n    <span class=\"token string\">'&lt;/div&gt;'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<p>The full source is available at <a href=\"https://github.com/citation-js/site/blob/master/static/js/blog.js\">here</a>, and the page can be viewed <a href=\"https://citation.js.org/blog/\">here</a>.</p>\n<p><img src=\"https://lh3.googleusercontent.com/Qd8EXpblQui1CSErr_BU1Os9Ykk-ximWT_hcTxGhtJBwY6JoM7jSxt7FlAwOSkAs57G4nZ64ccAtMg=s2000\" alt=\"Blog screenshot\"><br>\n<em>Blog screenshot</em></p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-4600604544725167666","title":"Modern Altmetric badges","link":"https://larsgw.blogspot.com/feeds/4600604544725167666/comments/default","published":"2018-08-11T13:07:00.001+02:00","description":"Modern Altmetric badges    I recently found myself working with Altmetric badges  again, and I realized how cumbersome it can be to work with scripts. The Altmetric badges can only be added by using...","isPermalink":false,"tags":["programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:39.397+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Modern Altmetric badges</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>I recently found myself working with <a href=\"http://api.altmetric.com/embeds.html\">Altmetric badges </a> again, and I realized how cumbersome it can be to work with scripts. The Altmetric badges can only be added by using their JavaScript library, while it would be a lot more user friendly to have a simple URL that embeds the badge, preferably even an image. I may be a bit spoiled by the badge ecosystem of the open source community, including <a href=\"https://shields.io\">Shields.io</a>. There, badges are dynamically generated on the server side.</p>\n<p><img src=\"https://lh3.googleusercontent.com/UQg3vzcJxQfpfN-BxyrPL1mPXJA8DJuPbMaBT3f2j8OlO0rllgifKTGPIkTzKJFvEAWXNxXrNaGaHw\" alt=\"Badges in open source JavaScript projects\" title=\"Badges in open source JavaScript projects\"><br>\n<em>Badges in open source JavaScript projects</em></p>\n<p>Unfortunately, Shields doesn’t support Altmetric. It does, however, support dynamic badges, and Altmetric does have an API. The endpoint is <code>api.altmetric.com/v1/doi/</code> for DOI-based access (which is what we want in this case). So the parameters needed for the badge are:</p>\n<ul>\n<li>Data type: JSON (the output format of the API)</li>\n<li><code>label</code>: Altmetric</li>\n<li><code>url</code>: <code>https://api.altmetric.com/v1/doi/&lt;DOI&gt;</code></li>\n<li><code>query</code>: <code>$.score</code></li>\n<li><code>style</code>: <code>social</code></li>\n</ul>\n<p>The <code>logo</code> would be <code>https://www.altmetric.com/wp-content/themes/altmetric/favicon.ico</code>, but I can’t get that to work. The resulting URL is</p>\n<pre><code>https://img.shields.io/badge/dynamic/json.svg?url=https://api.altmetric.com/v1/doi/DOI&amp;label=Altmetric&amp;query=$.score&amp;style=social\n</code></pre>\n<p>Which looks like this: <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAAAUCAYAAACDIGNiAAAHm0lEQVRoQ+2aB2hUWxCGZ+2xYO8ae0HEAvaGJdjQGHsHA/beK3ajsUQRuyYRY1fsDRGxJWAX1FijMUZRLNjFvo9v4CzXuzchD/MgWd9A2N1798yZmf+f/5xzNy632+1+8uSJ/Pz5Uz59+iS+aDly5JCMGTNKiRIlkkyPGvz48UM+f/6cpkuQPXt2zaVkyZLiSkxMdGfKlEkKFiyYpoP+0+BevHih4JC03RITE7Ug6aUGr1690mZzxcfHu5Nj5J8WLS2Np7tKly7tFVJ8fHyyXZmWcjCxPH36VFyxsbHuihUrpsX4Uj2me/fuSZUqVbz83rp1SypUqJDq8/2XDu/fv/8/eBQ4XYOXGqxzu93icrlSjWyp7Y/AYKvPdV5S4KGrPXr0kNy5c8u+ffskc+bMCs7t27dl4MCBsnDhQmnQoIEcOXJEHj16JMOGDUsV8G7cuCGbN2+WRYsWOfrbvn27rF69Wo4fPy7svlJqSYFHPuXLl3d0M3r0aHn48KEcPHhQ779+/VoWLFgg165dk1KlSsmUKVOSlNybN2/K/Pnz5eXLl9K8eXMZP3681pDYyc9qbdu2lenTp+ullStXyuHDh+XXr1/Srl07GTlypFdsHtksV66cY+Dh4eGeSWbOnKkBGPAGDx6sSQBe586dpXbt2jJ58uSU1jHZ782dO1cAcNeuXY7fY+26fv26BAUFCTvllNqDBw+8Og/JZAeaLVs2Lze7d++WpUuX6i7UgEcdrl69qgXdtGmTvH//Xvbu3esVB8pBXfLkySMAExYWpuBxjdiZF0tISJD9+/cryM2aNVPfNEH//v01JoBcvny51KlT57f4POCVLVvWK3BQ7969u1SqVEnu3LmjLCMAO3gXL17UrsSYHKZ26NBBA4adX79+1e69dOmSAgLIs2bN0mRJnsBJNCAgQIYMGSLnzp0TCoTly5dPduzYIS1btpT69esLTCYm2LtmzRo5duyYdh4shclv376V6tWry9SpU7VodqODrLKZ3FqHkgQHB+su9N27dx7wunTpojnQcSjOnDlzZN26dVKtWrXfpmN8z549Zdq0aRIYGKhxFy9eXJYsWaLLC3/kPWjQIClWrJjmzOcrV67I8OHDVdX8/PyUJORao0YNZ/DKlCnjleiFCxdk0qRJMnv2bAUPqdq6dasGwGfTeWy9eV+5cmWdNFeuXNoRFAkZMONJkuLC5GXLlulhmPsUOmvWrBISEqLjGzduLPPmzRO6hM7Gf6tWraRw4cIydOhQQSViYmI0oaNHj8rjx491fopKgviBPFyzG0cCAx7FJRcn4zw4YMAAJQIkPn36tAe8UaNGyYcPH1T61q5dKzt37tQ5jSoZf5cvX5YRI0ao9JMT8UDkjRs3eqY8c+aMggv5zRkTUAGSJQFr3bq1kh1grebpPLrKbhT9/PnzEhUVJax9Y8eOlV69emk7Ax6FJGg6olu3blKrVi2ZOHGisrRjx47KKNgGg/BDhyF3XAdIGHbgwAHh6Qf2/ft3BWnMmDEqIUgLXUfCbdq0ka5du+qcJIGcUjg6jsQjIiL0Pb7wkyVLFi263ZColIC3fv167SrmiIyM1PjpbLoZUqEuHJT9/f2VPMmBR/5NmjTRvL99+/YbeMhj3rx5lazGYmNj9bsAj2yGhobq/RYtWjiDRxBWQ8cpFgy0GjJGB8bFxaku49QJvE6dOmmh0XeYBwspOGyBgRADGT1x4oRKX4YMGeTNmzdaHIoOeEgscwEeEtyvXz/p27evhoMvpOrQoUMKHgVm3WFjBbHofqeuotApkU3kEj9WQz5ZA3my8fHjR73FkjFjxgwFBOWxGl0O2VGW9u3bq4TiY/Hixfo1SE5e1IIlw9iGDRu0YVAX03ksRxMmTHAGz/7IiEKsWrVKGWaevgAAnUDX5M+fX8GDcfXq1ZM+ffro+kRX0sVW8AiWsciLAQ8fEINXQClSpIgyjAWdLmNdOHv2rH6uW7euJklBmccOHt2E3DIOmSPuRo0a6Vi78RjMflRw2rBwzTznBTCIRB5Vq1bVOE+ePCnjxo2Tbdu2yZcvXzQ35A4ysRygOJCQOhQqVEiaNm0qK1asUGVClbDo6GgFhFoXLVrUE+qpU6cUcGQ7Z86cusQgrew6reaRTTtL6Q7YtWXLFs/ZjWToxpo1a2oHUDB2hYAHU0gSeeAIwfrD5oPgAcIAT8dyHQ1v2LChJo/c4Rv2QQi6EEZTJDqIDoO5gNy7d2+Nn7mQNmSXDQsShy/YTHwUibF2Q/6dznn2o4L1vMomjTUPYJBsjgoU1zytYd2GfBiE4b5Z1+7evavq9Pz5c80PsMgPAzQIwQbNumNmbrpvz549SgDWPJrIfob2gGdFHsc8pMWQCKtxnQRwynte+UxAZveU1D3jyzqOMSYZ45f5rNcZZx1jvW98JuXHDt6zZ8/+9SGduYmRtdQYxTb5WpcWA4K5xncYzyt1sdYTn9yz+jX+zZx8to8z3/GAR2v/DcYvCz73hKVAgQJ/A3a6Q/Qp8OLi4txmu+7rCLK2Oj1NSrc/CSUkJLjRXafHQ74EJrtCnszYj0XkmG5/jOXfIDj/sMiSoC8axGQz4QScyTc9/hvEP8IK07W/58KKAAAAAElFTkSuQmCC\" alt=\"Altmetric badge\"></p>\n<p>Note, however, that the use of the <a href=\"http://api.altmetric.com/\">Altmetric API is limited</a>:</p>\n<blockquote>\n<p>Free, rate-limited API</p>\n<ul>\n<li>No key required.</li>\n<li>Includes research object metadata and metrics only.</li>\n<li>Available only for one-time, limited term research projects.</li>\n<li>Best for small projects.</li>\n<li>Rate limited to 1 call per second.</li>\n</ul>\n</blockquote>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-518446966761713770","title":"Citation.js: Use Case for a Wikidata GraphQL API","link":"https://larsgw.blogspot.com/feeds/518446966761713770/comments/default","published":"2018-07-18T23:19:00.002+02:00","description":"Citation.js: Use Case for a Wikidata GraphQL API    Citation.js has supported Wikidata input for a long time. However, I’ve always had some trouble with the API. See, when Citation.js processes Wikidata...","isPermalink":false,"tags":["Citation.js","programming","Wikidata"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:48:45.656+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Citation.js: Use Case for a Wikidata GraphQL API</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>Citation.js has supported Wikidata input for a long time. However, I’ve always had some trouble with the API. See, when Citation.js processes <a href=\"https://wikidata.org\">Wikidata</a> API output (<a href=\"https://www.wikidata.org/w/api.php?action=wbgetentities&amp;ids=Q23571040&amp;format=json\">which looks like this</a>) and gets to, say, the <a href=\"https://wikidata.org/wiki/Property:P50\"><code>P50</code> (author)</a> property, it encounters this:</p>\n<pre class=\" language-json\"><code class=\"prism  language-json\"><span class=\"token string\">\"P50\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token string\">\"mainsnak\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token string\">\"snaktype\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string\">\"property\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"P50\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string\">\"hash\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1202966ec4cf715d3b9ff6faba202ac6c6ac3df8\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string\">\"datavalue\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token string\">\"entity-type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"item\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"numeric-id\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2062803</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Q2062803\"</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"wikibase-entityid\"</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string\">\"datatype\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"wikibase-item\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"statement\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Q46601020$692cc18d-4f54-eb65-8f0a-2fbb696be564\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string\">\"rank\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"normal\"</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n<p>The problem with this is that there’s no name string readily available: to get the name of this author, and of any author, journal, publisher, etcetera, Citation.js has to make extra queries to the API, to get the data.</p>\n<p>In the case of people, you could then just grab the label, but there’s also <a href=\"https://wikidata.org/wiki/Property:P735\"><code>P735</code> (given name)</a> and <a href=\"https://wikidata.org/wiki/Property:P734\"><code>P734</code> (family name)</a> in Wikidata. That saves some <a href=\"https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/\">error-prone</a> name parsing, you might think. However, this is what the API output looks like:</p>\n<pre class=\" language-json\"><code class=\"prism  language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"P735\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"mainsnak\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"snaktype\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"property\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"P735\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"hash\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"26c75e68a9844db73d0ff2e0da5652c5d571e46d\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"datavalue\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token string\">\"entity-type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"item\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"numeric-id\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">15635262</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"Q15635262\"</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"wikibase-entityid\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"datatype\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"wikibase-item\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"statement\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"Q22581$3554EADD-B8D8-4506-905B-014823ECC3EA\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"rank\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"normal\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"P734\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"mainsnak\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"snaktype\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"property\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"P734\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"hash\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"030e6786766f927e67ed52380f984be79d0f6111\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"datavalue\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token string\">\"entity-type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"item\"</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"numeric-id\"</span><span class=\"token punctuation\">:</span><span class=\"token number\">41587275</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"Q41587275\"</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"wikibase-entityid\"</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"datatype\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"wikibase-item\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"statement\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"Q22581$598DF0D7-CEC7-470B-8D0F-DD320796BF01\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"rank\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"normal\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>Another two dead ends, another two (one, with some effort) API calls. It would be great if it was possible to get this data with a single API call. I think <a href=\"https://graphql.org\">GraphQL</a> would be a good option here. With GraphQL, you can specify exactly what data you want. I’m not the first one to think of this; in fact, a <a href=\"https://phabricator.wikimedia.org/T173214#3865779\">simple example is already implemented</a>. This is what a query would look like (variables: <code>{\"item\": \"Q30000000\"}</code>): <a href=\"https://tools.wmflabs.org/tptools/wdql.html?query=query%20(%24item%3A%20ID!)%20%7B%0A%20%20entry%3A%20item(id%3A%20%24item)%20%7B%0A%20%20%20%20claims%3A%20statements%20%7B%0A%20%20%20%20%20%20mainsnak%20%7B%0A%20%20%20%20%20%20%20%20...%20on%20PropertyValueSnak%20%7B%0A%20%20%20%20%20%20%20%20%20%20property%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3A%20label(language%3A%20%22en%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20value%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20MonolingualTextValue%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3A%20text%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20StringValue%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20Item%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20label(language%3A%20%22en%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20QuantityValue%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20amount%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20unit%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3A%20label(language%3A%20%22en%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20TimeValue%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3A%20time%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D\">Try it online!</a></p>\n<pre class=\" language-graphql\"><code class=\"prism  language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$item</span><span class=\"token punctuation\">:</span> ID<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">entry</span><span class=\"token punctuation\">:</span> item<span class=\"token punctuation\">(</span><span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\"># get every property</span>\n    <span class=\"token comment\"># to get specific properties, use \"statements(properties: [...])\"</span>\n    <span class=\"token attr-name\">claims</span><span class=\"token punctuation\">:</span> statements <span class=\"token punctuation\">{</span>\n      mainsnak <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> PropertyValueSnak <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\"># get property id and English label</span>\n          property <span class=\"token punctuation\">{</span>\n            id\n            <span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> label<span class=\"token punctuation\">(</span><span class=\"token attr-name\">language</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              text\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token comment\"># get value</span>\n          value <span class=\"token punctuation\">{</span>\n            <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> MonolingualTextValue <span class=\"token punctuation\">{</span>\n              <span class=\"token attr-name\">value</span><span class=\"token punctuation\">:</span> text\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> StringValue <span class=\"token punctuation\">{</span>\n              value\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\"># if value is an item, get the label too</span>\n            <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> Item <span class=\"token punctuation\">{</span>\n              id\n              label<span class=\"token punctuation\">(</span><span class=\"token attr-name\">language</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                text\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> QuantityValue <span class=\"token punctuation\">{</span>\n              amount\n              unit <span class=\"token punctuation\">{</span>\n                <span class=\"token attr-name\">value</span><span class=\"token punctuation\">:</span> label<span class=\"token punctuation\">(</span><span class=\"token attr-name\">language</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"en\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                  text\n                <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> TimeValue <span class=\"token punctuation\">{</span>\n              <span class=\"token attr-name\">value</span><span class=\"token punctuation\">:</span> time\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>Another handy thing is that the API output is basically the equivalent of the query in JSON, but with the data filled in. I think a GraphQL API would be really useful for this and similar use cases, and it definitely seems possible given the fact that there is an experimental API available.</p>\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-3781582023912504297","title":"Journal Metadata: Authors & Institutions","link":"https://larsgw.blogspot.com/feeds/3781582023912504297/comments/default","published":"2018-07-17T19:13:00.001+02:00","description":"Journal Metadata: Authors & Institutions    I finished the General Plugin system for Citation.js a few days ago (more on that later), so I could finally publish a new beta release. Now, after that...","isPermalink":false,"tags":["bibliography","Citation.js","ContentMine"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:49:00.003+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Journal Metadata: Authors &amp; Institutions</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>I finished the General Plugin system for <a href=\"https://citation.js.org\">Citation.js</a> a few days ago (more on that later), so I could finally publish a new beta release. Now, after that half-finished piece of code had been blocking other work for a long while, I can at last start… fixing bugs, and closing other items in the backlog.</p>\n<p>One of the items that has been on the backlog for a long time, and was on the backlog of the previous major version too, was sorting out BibJSON. BibJSON has been “supported” since before CSL-JSON was introduced as the internal standard, but under the name of ContentMine JSON, as I only knew it as the output of <a href=\"http://contentmine.org/\">ContentMine</a>’s <a href=\"https://github.com/ContentMine/quickscrape\"><code>quickscrape</code></a> tool.</p>\n<p><img src=\"https://1.bp.blogspot.com/-ObI93Tq3y38/W0yuylNQO7I/AAAAAAAAT_o/ppud86I5AsEfXeDR-75hCDF9d2pkfJ-2gCK4BGAYYCw/s1600/screenshot_log_single_url.png\" alt=\"quickscrape output\"><br>\n<em><code>quickscrape</code> output (<a href=\"https://github.com/ContentMine/quickscrape/blob/master/docs/screenshot_log_single_url.png\">source</a>, license: <a href=\"https://github.com/ContentMine/quickscrape/blob/master/LICENSE\">MIT</a>)</em></p>\n<p>Since then, I learned it actually was a more standardised format, but never got to the act of reading the standard and updating the parser. Today, however, I did. Turns out, it is something in between JSON-LD and BibTeX. While searching around for more comprehensive documentation, I saw the <a href=\"https://github.com/ContentMine/journal-scrapers\"><code>journal-scrapers</code></a> (used by <code>quickscrape</code>) again, which I used to compile some test cases.</p>\n<p>Unfortunately, one of the first examples went wrong already. The <code>meta</code> tags, containing the bibliographical data that <code>quickscrape</code> scrapes, specifically data pertaining to the authors, are not structured in a machine-friendly way, in my opinion. Certainly, <code>quickscrape</code> has trouble with it.</p>\n<pre class=\" language-html\"><code class=\"prism  language-html\">...\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>P. Pandikumar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author_institution<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Division of Ethnopharmacology, Entomology Research Institute, Loyola College, Chennai, India<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>S. Ignacimuthu<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author_institution<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Division of Ethnopharmacology, Entomology Research Institute, Loyola College, Chennai, India<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author_institution<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>International Scientific Partnership Programme, King Saud University, Riyadh, Saudi Arabia<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>N. A. Al-Dhabi<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>citation_author_institution<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Addiriyah Chair for Environmental Studies, College of Science, King Saud University, Riyadh, Saudi Arabia<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n...\n</code></pre>\n<p><a href=\"https://ethnobiomed.biomedcentral.com/articles/10.1186/1746-4269-2-29\">This particular example</a> is from Biomed Central. However, the pattern persists throughout multiple journals: Nature (<a href=\"https://www.nature.com/articles/s41437-018-0061-6\">example</a>), PLOS One (<a href=\"http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0199896\">example</a>), PeerJ (<a href=\"http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0199896\">example</a>), and probably many more, as these were just the first four I checked.</p>\n<blockquote>\n<p>Prepend <code>view-source:</code> to those example URLs to quickly view the HTML source, with the <code>meta</code> tags.</p>\n</blockquote>\n<p>The pattern is so similar, especially the authors always being after a whole list of <code>citation_reference</code>s in the case of Nature and BMC, that there must be some sort of library or service that generates these, I thought. This quest first led me to search what kind of tags <code>citation_</code> are. The fact that the answer wasn’t very easy to find and the amount of unanswered questions I found along the way quickly made it clear what kind of quest this was going to be.</p>\n<p>First of all, the tags: they’re called HighWire Press tags. Normally I would link a website, but I don’t think there is any. They’re the <a href=\"https://scholar.google.com/intl/en-US/scholar/inclusion.html#indexing\">preferred method of metadata tagging of Google Scholar</a>, which lists 16 tags, they’re also the <a href=\"https://www.mendeley.com/guides/information-for-publishers\">preferred format of Mendeley</a>, which points to the Google Scholar documentation, and yet the only thing I find searching for some canonical list is people asking where that list could be, and getting no answers (<a href=\"https://webmasters.stackexchange.com/q/72746\">1</a>, <a href=\"https://productforums.google.com/forum/#!topic/webmasters/wOnBPISf4eA\">2</a>).</p>\n<p>Even with the 16-tag list, I can find at least two tags, each non-trivial (e.g. <code>citation_reference</code> and <code>citation_author_institution</code>), in <em>any</em> of the examples mentioned above, that aren’t on that list. Not to mention that, again, those examples weren’t chosen, they were <em>picked semi-randomly</em>.</p>\n<p>Luckily, I’m not the first one to run into this problem. Someone previously compiled a <a href=\"http://cheb.hatenablog.com/entry/2014/07/25/002548\">list of 39 <code>citation_</code> tags</a> based on observations, which is very useful if I want to write a crosswalk for Citation.js sometime, but doesn’t really help with finding a generator.</p>\n<p>Back to HighWire: they claim Nature is <a href=\"http://highwire.stanford.edu/lists/allsites.dtl#N\">one of their customers</a>. BMC and Springer Open, however, aren’t, and yet they share the same system, or a common standard that can’t be found anywhere else. That they share a system makes sense, but what system and/or standard are they using? I asked, and will report back when I get an answer.</p>\n<blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\"><a href=\"https://twitter.com/BioMedCentral?ref_src=twsrc%5Etfw\">@BioMedCentral</a>, <a href=\"https://twitter.com/SpringerOpen?ref_src=twsrc%5Etfw\">@SpringerOpen</a>: how do you generate metadata tags on your web pages? cc <a href=\"https://twitter.com/samofthedamned?ref_src=twsrc%5Etfw\">@samofthedamned</a> <a href=\"https://t.co/EkjLVOf68t\">https://t.co/EkjLVOf68t</a></p>— Lars Willighagen (@larswillighagen) <a href=\"https://twitter.com/larswillighagen/status/1018101404517445634?ref_src=twsrc%5Etfw\">July 14, 2018</a></blockquote>\n\n</div>\n</body>\n\n</html>"},{"id":"tag:blogger.com,1999:blog-5472537257659342064.post-1325135806549844620","title":"Debugging: Deja Vu","link":"https://larsgw.blogspot.com/feeds/1325135806549844620/comments/default","published":"2018-04-30T12:46:00.001+02:00","description":"Debugging: Deja Vu    I’m going to share some stories on debugging with you, because I’m proud of them. After writing up the first story, I’m no longer particularly proud, but I still want to share the...","isPermalink":false,"tags":["programming"],"authors":[{"name":"Lars Willighagen","url":null}],"image":null,"modified":"2023-03-30T22:49:12.275+02:00","contentHtml":"<!DOCTYPE html>\n<html>\n\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Debugging: Deja Vu</title>\n  <link rel=\"stylesheet\" href=\"https://stackedit.io/style.css\" />\n</head>\n\n<body class=\"stackedit\">\n  <div class=\"stackedit__html\"><p>I’m going to share some stories on debugging with you, <s>because I’m proud of them</s>. After writing up the first story, I’m no longer particularly proud, but I still want to share the story. Here’s the first: a bug that seemed quite familiar.</p>\n<p>After <a href=\"https://twitter.com/larswillighagen/status/986718567633735682\">some trouble with mocking API requests</a> I decided that supporting mocking in the browser isn’t as important as supporting mocking at all, so I installed <a href=\"https://www.npmjs.com/package/mock-require\">mock-require</a> (I didn’t get <a href=\"https://www.npmjs.com/package/proxyquire\">proxyquire</a> to work). Now, to confirm that the test bundle script actually omitted the API mocking code from the bundle, I loaded the test suite in the browser. Guess what? Errors everywhere! Or rather, error everywhere. Every test case gave the same error:</p>\n<blockquote>\n<pre><code>TypeError: Cannot assign to read only property 'length' of function 'function () {\n          old.apply(self, arguments);\n        }'\n    at new Assertion (/build/test.citation.js:1810:30)\n    at new Assertion (/build/test.citation.js:1799:25)\n    at new Assertion (/build/test.citation.js:1799:25)\n    at new Assertion (/build/test.citation.js:1799:25)\n    at expect (/build/test.citation.js:1775:12)\n    at Context._callee2$ (/build/test.citation.js:3582:35)\n    at tryCatch (/build/citation.js:7891:17)\n    at Generator.invoke [as _invoke] (/build/citation.js:8064:22)\n    at Generator.prototype.(anonymous function) [as next] (/build/citation.js:7934:21)\n    at step (/build/test.citation.js:3542:221)\n</code></pre>\n</blockquote>\n<p>Naturally, like a good programmer, I immediately googled the error message in conjunction with the various tools and frameworks I used for this bundle, instead of looking at the stack trace showing that something’s wrong with <a href=\"https://github.com/Automattic/expect.js\">expect.js</a>. Anyway, after some time, I found a <a href=\"https://github.com/Automattic/expect.js/issues/149\">GitHub issue</a> describing exactly the problem I was having. Scrolling through the responses, I was stunned:</p>\n<blockquote>\n<p><strong><a href=\"https://github.com/larsgw\">larsgw</a></strong> commented  <a href=\"https://github.com/Automattic/expect.js/issues/149#issuecomment-318820971\">on Jul 29, 2017</a><br>\n+1: Same issue, but for all assertions</p>\n</blockquote>\n<p>Somehow, I reported the same issue 10 months ago, but the site, running a bundle from 2 months old didn’t have the problem. Apparently, I had fixed the issue earlier, but forgotten about the solution, and I couldn’t figure out what that solution was. So I started debugging. First of all, the offending code wasn’t different from any other working bundle. It registered a bunch of functions as properties to a function, and it choked on the <code>length</code> property. Makes sense, the <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/length\"><code>length</code> property isn’t writable on functions</a>. But running some simple test code showed this shouldn’t be the problem:</p>\n<pre class=\" language-js\"><code class=\"prism  language-js\"><span class=\"token keyword\">let</span> <span class=\"token function-variable function\">f</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0</span>\nf<span class=\"token punctuation\">.</span>length <span class=\"token operator\">=</span> <span class=\"token number\">3</span>   <span class=\"token comment\">// (no error)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 0</span>\n</code></pre>\n<p>Sure, it didn’t actually do anything, but it didn’t throw an exception either. Besides, this was the exact same lines of code as in the GitHub repo, so how could that be the issue? The only thing I could do was comparing with the working examples. Diffing my bundle against the published one, which was difficult, because it’s generated code. Checking out commits until I found out which one worked, which was a pain because I repeatedly forgot to reinstall dependencies, something that could be critical.</p>\n<blockquote>\n<p>Sidebar (minor spoilers): the previous time I ‘solved’ the issue, it was much easier, because it was the first time setting the system up, so instead of referring to older commits as working examples, I looked at the docs.</p>\n</blockquote>\n<p>After a long while I realised what the workaround was earlier: instead of bundling expect.js with Browserify, I included it as a script (as <a href=\"https://github.com/Automattic/expect.js#browser\">recommended</a>) and created a wrapper that exposed the <code>expect.js</code> module and simply grabbed and exported the global <code>expect</code> variable exposed by the script. I thought this was because the order of requiring the scripts mattered, but some testing proved this wasn’t the case. No, actually including expect.js into a Browserify bundle with Babelify transform on, or even simply running it through the Babel compiler caused the error.</p>\n<p>Back to diffing bundles I guess: what <em>are</em> the differences between a babel-ed file and its source code if there isn’t really any syntax that needs to be transformed, or APIs that need to be polyfilled?</p>\n<p>Turns out, not much. Between those files, the only real difference was the location (or with <code>comments: false</code> the existence) of comments, and some style differences caused by Babel’s code generator.</p>\n<p>And <code>'use strict'</code>.</p>\n<p>Apparently, <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode\"><code>'use strict'</code> makes assignments that otherwise fail silently throw an error</a>. If I had read that documentation earlier, or if I had payed proper attention to the <code>Function.prototype.length</code> docs (linked above), I would have known. Now it’s just a boring ending to a long journey. But hey, at least I learned some stuff.</p>\n<hr>\n<p>Solving this issue requires either a big change in the internals of a toolkit that hasn’t had an update in 4(!) years, or a workaround. I don’t want to use the workaround of including two extra files anymore, now that I know what is causing the issue, but the other workaround proves to be a problem itself, involving outdated documentation and <a href=\"https://github.com/babel/babelify/issues/265\">a bug in Babelify</a>. More on that later.</p>\n<p>On a related note: I’m working on a new release for Citation.js, improving the parsing plugin system. The API should be pretty stable now, apart from the namespaces being prone to change, so I might change the schedule to one update with all current API changes instead.</p>\n</div>\n</body>\n\n</html>"}]}